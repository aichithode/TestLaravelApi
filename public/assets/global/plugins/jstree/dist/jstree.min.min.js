/*! jsTree - v3.2.1 - 2015-08-24 - (MIT) */
!function(b){"function"==typeof define&&define.amd?define(["jquery"],b):"undefined"!=typeof module&&module.exports?module.exports=b(require("jquery")):b(jQuery)}(function(H,G){if(!H.jstree){var F=0,E=!1,D=!1,C=!1,B=[],A=H("script:last").attr("src"),z=window.document,y=z.createElement("LI"),x,w;y.setAttribute("role","treeitem"),x=z.createElement("I"),x.className="jstree-icon jstree-ocl",x.setAttribute("role","presentation"),y.appendChild(x),x=z.createElement("A"),x.className="jstree-anchor",x.setAttribute("href","#"),x.setAttribute("tabindex","-1"),w=z.createElement("I"),w.className="jstree-icon jstree-themeicon",w.setAttribute("role","presentation"),x.appendChild(w),y.appendChild(x),x=w=null,H.jstree={version:"3.2.1",defaults:{plugins:[]},plugins:{},path:A&&-1!==A.indexOf("/")?A.replace(/\/[^\/]+$/,""):"",idregex:/[\\:&!^|()\[\]<>@*'+~#";.,=\- \/${}%?`]/g,root:"#"},H.jstree.create=function(a,h){var g=new H.jstree.core(++F),c=h;return h=H.extend(!0,{},H.jstree.defaults,h),c&&c.plugins&&(h.plugins=c.plugins),H.each(h.plugins,function(e,d){"core"!==e&&(g=g.plugin(d,h[d]))}),H(a).data("jstree",g),g.init(a,h),g},H.jstree.destroy=function(){H(".jstree:jstree").jstree("destroy"),H(z).off(".jstree")},H.jstree.core=function(b){this._id=b,this._cnt=0,this._wrk=null,this._data={core:{themes:{name:!1,dots:!1,icons:!1},selected:[],last_error:{},working:!1,worker_queue:[],focused:null}}},H.jstree.reference=function(a){var h=null,g=null;if(!a||!a.id||a.tagName&&a.nodeType||(a=a.id),!g||!g.length){try{g=H(a)}catch(f){}}if(!g||!g.length){try{g=H("#"+a.replace(H.jstree.idregex,"\\$&"))}catch(f){}}return g&&g.length&&(g=g.closest(".jstree")).length&&(g=g.data("jstree"))?h=g:H(".jstree").each(function(){var b=H(this).data("jstree");return b&&b._model.data[a]?(h=b,!1):void 0}),h},H.fn.jstree=function(h){var g="string"==typeof h,b=Array.prototype.slice.call(arguments,1),a=null;return h!==!0||this.length?(this.each(function(){var d=H.jstree.reference(this),c=g&&d?d[h]:null;return a=g&&c?c.apply(d,b):null,d||g||h!==G&&!H.isPlainObject(h)||H.jstree.create(this,h),(d&&!g||h===!0)&&(a=d||!1),null!==a&&a!==G?!1:void 0}),null!==a&&a!==G?a:this):!1},H.expr[":"].jstree=H.expr.createPseudo(function(a){return function(b){return H(b).hasClass("jstree")&&H(b).data("jstree")!==G}}),H.jstree.defaults.core={data:!1,strings:!1,check_callback:!1,error:H.noop,animation:200,multiple:!0,themes:{name:!1,url:!1,dir:!1,dots:!0,icons:!0,stripes:!1,variant:!1,responsive:!1},expand_selected_onload:!0,worker:!0,force_text:!1,dblclick_toggle:!0},H.jstree.core.prototype={plugin:function(a,f){var e=H.jstree.plugins[a];return e?(this._data[a]={},e.prototype=this,new e(f,this)):this},init:function(a,d){this._model={data:{},changed:[],force_full_redraw:!1,redraw_timeout:!1,default_state:{loaded:!0,opened:!1,selected:!1,disabled:!1}},this._model.data[H.jstree.root]={id:H.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}},this.element=H(a).addClass("jstree jstree-"+this._id),this.settings=d,this._data.core.ready=!1,this._data.core.loaded=!1,this._data.core.rtl="rtl"===this.element.css("direction"),this.element[this._data.core.rtl?"addClass":"removeClass"]("jstree-rtl"),this.element.attr("role","tree"),this.settings.core.multiple&&this.element.attr("aria-multiselectable",!0),this.element.attr("tabindex")||this.element.attr("tabindex","0"),this.bind(),this.trigger("init"),this._data.core.original_container_html=this.element.find(" > ul > li").clone(!0),this._data.core.original_container_html.find("li").addBack().contents().filter(function(){return 3===this.nodeType&&(!this.nodeValue||/^\s+$/.test(this.nodeValue))}).remove(),this.element.html("<ul class='jstree-container-ul jstree-children' role='group'><li id='j"+this._id+"_loading' class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='tree-item'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading"),this._data.core.li_height=this.get_container_ul().children("li").first().height()||24,this.trigger("loading"),this.load_node(H.jstree.root)},destroy:function(d){if(this._wrk){try{window.URL.revokeObjectURL(this._wrk),this._wrk=null}catch(c){}}d||this.element.empty(),this.teardown()},teardown:function(){this.unbind(),this.element.removeClass("jstree").removeData("jstree").find("[class^='jstree']").addBack().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/gi,"")}),this.element=null},bind:function(){var a="",f=null,e=0;this.element.on("dblclick.jstree",function(g){if(g.target.tagName&&"input"===g.target.tagName.toLowerCase()){return !0}if(z.selection&&z.selection.empty){z.selection.empty()}else{if(window.getSelection){var d=window.getSelection();try{d.removeAllRanges(),d.collapse()}catch(h){}}}}).on("mousedown.jstree",H.proxy(function(b){b.target===this.element[0]&&(b.preventDefault(),e=+new Date)},this)).on("mousedown.jstree",".jstree-ocl",function(b){b.preventDefault()}).on("click.jstree",".jstree-ocl",H.proxy(function(b){this.toggle_node(b.target)},this)).on("dblclick.jstree",".jstree-anchor",H.proxy(function(b){return b.target.tagName&&"input"===b.target.tagName.toLowerCase()?!0:void (this.settings.core.dblclick_toggle&&this.toggle_node(b.target))},this)).on("click.jstree",".jstree-anchor",H.proxy(function(c){c.preventDefault(),c.currentTarget!==z.activeElement&&H(c.currentTarget).focus(),this.activate_node(c.currentTarget,c)},this)).on("keydown.jstree",".jstree-anchor",H.proxy(function(d){if(d.target.tagName&&"input"===d.target.tagName.toLowerCase()){return !0}if(32!==d.which&&13!==d.which&&(d.shiftKey||d.ctrlKey||d.altKey||d.metaKey)){return !0}var g=null;switch(this._data.core.rtl&&(37===d.which?d.which=39:39===d.which&&(d.which=37)),d.which){case 32:d.ctrlKey&&(d.type="click",H(d.currentTarget).trigger(d));break;case 13:d.type="click",H(d.currentTarget).trigger(d);break;case 37:d.preventDefault(),this.is_open(d.currentTarget)?this.close_node(d.currentTarget):(g=this.get_parent(d.currentTarget),g&&g.id!==H.jstree.root&&this.get_node(g,!0).children(".jstree-anchor").focus());break;case 38:d.preventDefault(),g=this.get_prev_dom(d.currentTarget),g&&g.length&&g.children(".jstree-anchor").focus();break;case 39:d.preventDefault(),this.is_closed(d.currentTarget)?this.open_node(d.currentTarget,function(b){this.get_node(b,!0).children(".jstree-anchor").focus()}):this.is_open(d.currentTarget)&&(g=this.get_node(d.currentTarget,!0).children(".jstree-children")[0],g&&H(this._firstChild(g)).children(".jstree-anchor").focus());break;case 40:d.preventDefault(),g=this.get_next_dom(d.currentTarget),g&&g.length&&g.children(".jstree-anchor").focus();break;case 106:this.open_all();break;case 36:d.preventDefault(),g=this._firstChild(this.get_container_ul()[0]),g&&H(g).children(".jstree-anchor").filter(":visible").focus();break;case 35:d.preventDefault(),this.element.find(".jstree-anchor").filter(":visible").last().focus()}},this)).on("load_node.jstree",H.proxy(function(d,g){g.status&&(g.node.id!==H.jstree.root||this._data.core.loaded||(this._data.core.loaded=!0,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.trigger("loaded")),this._data.core.ready||setTimeout(H.proxy(function(){if(this.element&&!this.get_container_ul().find(".jstree-loading").length){if(this._data.core.ready=!0,this._data.core.selected.length){if(this.settings.core.expand_selected_onload){var h=[],j,i;for(j=0,i=this._data.core.selected.length;i>j;j++){h=h.concat(this._model.data[this._data.core.selected[j]].parents)}for(h=H.vakata.array_unique(h),j=0,i=h.length;i>j;j++){this.open_node(h[j],!1,0)}}this.trigger("changed",{action:"ready",selected:this._data.core.selected})}this.trigger("ready")}},this),0))},this)).on("keypress.jstree",H.proxy(function(k){if(k.target.tagName&&"input"===k.target.tagName.toLowerCase()){return !0}f&&clearTimeout(f),f=setTimeout(function(){a=""},500);var j=String.fromCharCode(k.which).toLowerCase(),i=this.element.find(".jstree-anchor").filter(":visible"),c=i.index(z.activeElement)||0,b=!1;if(a+=j,a.length>1){if(i.slice(c).each(H.proxy(function(h,g){return 0===H(g).text().toLowerCase().indexOf(a)?(H(g).focus(),b=!0,!1):void 0},this)),b){return}if(i.slice(0,c).each(H.proxy(function(h,g){return 0===H(g).text().toLowerCase().indexOf(a)?(H(g).focus(),b=!0,!1):void 0},this)),b){return}}if(new RegExp("^"+j.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+"+$").test(a)){if(i.slice(c+1).each(H.proxy(function(d,g){return H(g).text().toLowerCase().charAt(0)===j?(H(g).focus(),b=!0,!1):void 0},this)),b){return}if(i.slice(0,c+1).each(H.proxy(function(d,g){return H(g).text().toLowerCase().charAt(0)===j?(H(g).focus(),b=!0,!1):void 0},this)),b){return}}},this)).on("init.jstree",H.proxy(function(){var b=this.settings.core.themes;this._data.core.themes.dots=b.dots,this._data.core.themes.stripes=b.stripes,this._data.core.themes.icons=b.icons,this.set_theme(b.name||"default",b.url),this.set_theme_variant(b.variant)},this)).on("loading.jstree",H.proxy(function(){this[this._data.core.themes.dots?"show_dots":"hide_dots"](),this[this._data.core.themes.icons?"show_icons":"hide_icons"](),this[this._data.core.themes.stripes?"show_stripes":"hide_stripes"]()},this)).on("blur.jstree",".jstree-anchor",H.proxy(function(c){this._data.core.focused=null,H(c.currentTarget).filter(".jstree-hovered").mouseleave(),this.element.attr("tabindex","0")},this)).on("focus.jstree",".jstree-anchor",H.proxy(function(d){var g=this.get_node(d.currentTarget);g&&g.id&&(this._data.core.focused=g.id),this.element.find(".jstree-hovered").not(d.currentTarget).mouseleave(),H(d.currentTarget).mouseenter(),this.element.attr("tabindex","-1")},this)).on("focus.jstree",H.proxy(function(){if(+new Date-e>500&&!this._data.core.focused){e=0;var b=this.get_node(this.element.attr("aria-activedescendant"),!0);b&&b.find("> .jstree-anchor").focus()}},this)).on("mouseenter.jstree",".jstree-anchor",H.proxy(function(b){this.hover_node(b.currentTarget)},this)).on("mouseleave.jstree",".jstree-anchor",H.proxy(function(b){this.dehover_node(b.currentTarget)},this))},unbind:function(){this.element.off(".jstree"),H(z).off(".jstree-"+this._id)},trigger:function(d,c){c||(c={}),c.instance=this,this.element.triggerHandler(d.replace(".jstree","")+".jstree",c)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children(".jstree-children").first()},get_string:function(a){var d=this.settings.core.strings;return H.isFunction(d)?d.call(this,a):d&&d[a]?d[a]:a},_firstChild:function(b){b=b?b.firstChild:null;while(null!==b&&1!==b.nodeType){b=b.nextSibling}return b},_nextSibling:function(b){b=b?b.nextSibling:null;while(null!==b&&1!==b.nodeType){b=b.nextSibling}return b},_previousSibling:function(b){b=b?b.previousSibling:null;while(null!==b&&1!==b.nodeType){b=b.previousSibling}return b},get_node:function(a,h){a&&a.id&&(a=a.id);var g;try{if(this._model.data[a]){a=this._model.data[a]}else{if("string"==typeof a&&this._model.data[a.replace(/^#/,"")]){a=this._model.data[a.replace(/^#/,"")]}else{if("string"==typeof a&&(g=H("#"+a.replace(H.jstree.idregex,"\\$&"),this.element)).length&&this._model.data[g.closest(".jstree-node").attr("id")]){a=this._model.data[g.closest(".jstree-node").attr("id")]}else{if((g=H(a,this.element)).length&&this._model.data[g.closest(".jstree-node").attr("id")]){a=this._model.data[g.closest(".jstree-node").attr("id")]}else{if(!(g=H(a,this.element)).length||!g.hasClass("jstree")){return !1}a=this._model.data[H.jstree.root]}}}}return h&&(a=a.id===H.jstree.root?this.element:H("#"+a.id.replace(H.jstree.idregex,"\\$&"),this.element)),a}catch(f){return !1}},get_path:function(a,l,k){if(a=a.parents?a:this.get_node(a),!a||a.id===H.jstree.root||!a.parents){return !1}var j,i,h=[];for(h.push(k?a.id:a.text),j=0,i=a.parents.length;i>j;j++){h.push(k?a.parents[j]:this.get_text(a.parents[j]))}return h=h.reverse().slice(1),l?h.join(l):h},get_next_dom:function(a,f){var e;if(a=this.get_node(a,!0),a[0]===this.element[0]){e=this._firstChild(this.get_container_ul()[0]);while(e&&0===e.offsetHeight){e=this._nextSibling(e)}return e?H(e):!1}if(!a||!a.length){return !1}if(f){e=a[0];do{e=this._nextSibling(e)}while(e&&0===e.offsetHeight);return e?H(e):!1}if(a.hasClass("jstree-open")){e=this._firstChild(a.children(".jstree-children")[0]);while(e&&0===e.offsetHeight){e=this._nextSibling(e)}if(null!==e){return H(e)}}e=a[0];do{e=this._nextSibling(e)}while(e&&0===e.offsetHeight);return null!==e?H(e):a.parentsUntil(".jstree",".jstree-node").nextAll(".jstree-node:visible").first()},get_prev_dom:function(a,f){var e;if(a=this.get_node(a,!0),a[0]===this.element[0]){e=this.get_container_ul()[0].lastChild;while(e&&0===e.offsetHeight){e=this._previousSibling(e)}return e?H(e):!1}if(!a||!a.length){return !1}if(f){e=a[0];do{e=this._previousSibling(e)}while(e&&0===e.offsetHeight);return e?H(e):!1}e=a[0];do{e=this._previousSibling(e)}while(e&&0===e.offsetHeight);if(null!==e){a=H(e);while(a.hasClass("jstree-open")){a=a.children(".jstree-children").first().children(".jstree-node:visible:last")}return a}return e=a[0].parentNode.parentNode,e&&e.className&&-1!==e.className.indexOf("jstree-node")?H(e):!1},get_parent:function(a){return a=this.get_node(a),a&&a.id!==H.jstree.root?a.parent:!1},get_children_dom:function(b){return b=this.get_node(b,!0),b[0]===this.element[0]?this.get_container_ul().children(".jstree-node"):b&&b.length?b.children(".jstree-children").children(".jstree-node"):!1},is_parent:function(b){return b=this.get_node(b),b&&(b.state.loaded===!1||b.children.length>0)},is_loaded:function(b){return b=this.get_node(b),b&&b.state.loaded},is_loading:function(b){return b=this.get_node(b),b&&b.state&&b.state.loading},is_open:function(b){return b=this.get_node(b),b&&b.state.opened},is_closed:function(b){return b=this.get_node(b),b&&this.is_parent(b)&&!b.state.opened},is_leaf:function(b){return !this.is_parent(b)},load_node:function(a,n){var m,l,k,j,i;if(H.isArray(a)){return this._load_nodes(a.slice(),n),!0}if(a=this.get_node(a),!a){return n&&n.call(this,a,!1),!1}if(a.state.loaded){for(a.state.loaded=!1,m=0,l=a.children_d.length;l>m;m++){for(k=0,j=a.parents.length;j>k;k++){this._model.data[a.parents[k]].children_d=H.vakata.array_remove_item(this._model.data[a.parents[k]].children_d,a.children_d[m])}this._model.data[a.children_d[m]].state.selected&&(i=!0,this._data.core.selected=H.vakata.array_remove_item(this._data.core.selected,a.children_d[m])),delete this._model.data[a.children_d[m]]}a.children=[],a.children_d=[],i&&this.trigger("changed",{action:"load_node",node:a,selected:this._data.core.selected})}return a.state.failed=!1,a.state.loading=!0,this.get_node(a,!0).addClass("jstree-loading").attr("aria-busy",!0),this._load_node(a,H.proxy(function(b){a=this._model.data[a.id],a.state.loading=!1,a.state.loaded=b,a.state.failed=!a.state.loaded;var I=this.get_node(a,!0),q=0,p=0,o=this._model.data,c=!1;for(q=0,p=a.children.length;p>q;q++){if(o[a.children[q]]&&!o[a.children[q]].state.hidden){c=!0;break}}a.state.loaded&&!c&&I&&I.length&&!I.hasClass("jstree-leaf")&&I.removeClass("jstree-closed jstree-open").addClass("jstree-leaf"),I.removeClass("jstree-loading").attr("aria-busy",!1),this.trigger("load_node",{node:a,status:b}),n&&n.call(this,a,b)},this)),!0},_load_nodes:function(I,q,p){var o=!0,n=function(){this._load_nodes(I,q,!0)},m=this._model.data,l,k,j=[];for(l=0,k=I.length;k>l;l++){!m[I[l]]||(m[I[l]].state.loaded||m[I[l]].state.failed)&&p||(this.is_loading(I[l])||this.load_node(I[l],n),o=!1)}if(o){for(l=0,k=I.length;k>l;l++){m[I[l]]&&m[I[l]].state.loaded&&j.push(I[l])}q&&!q.done&&(q.call(this,j),q.done=!0)}},load_all:function(a,n){if(a||(a=H.jstree.root),a=this.get_node(a),!a){return !1}var m=[],l=this._model.data,k=l[a.id].children_d,j,i;for(a.state&&!a.state.loaded&&m.push(a.id),j=0,i=k.length;i>j;j++){l[k[j]]&&l[k[j]].state&&!l[k[j]].state.loaded&&m.push(k[j])}m.length?this._load_nodes(m,function(){this.load_all(a,n)}):(n&&n.call(this,a),this.trigger("load_all",{node:a}))},_load_node:function(a,h){var g=this.settings.core.data,f;return g?H.isFunction(g)?g.call(this,a,H.proxy(function(b){b===!1&&h.call(this,!1),this["string"==typeof b?"_append_html_data":"_append_json_data"](a,"string"==typeof b?H(H.parseHTML(b)).filter(function(){return 3!==this.nodeType}):b,function(c){h.call(this,c)})},this)):"object"==typeof g?g.url?(g=H.extend(!0,{},g),H.isFunction(g.url)&&(g.url=g.url.call(this,a)),H.isFunction(g.data)&&(g.data=g.data.call(this,a)),H.ajax(g).done(H.proxy(function(j,i,c){var b=c.getResponseHeader("Content-Type");return b&&-1!==b.indexOf("json")||"object"==typeof j?this._append_json_data(a,j,function(d){h.call(this,d)}):b&&-1!==b.indexOf("html")||"string"==typeof j?this._append_html_data(a,H(H.parseHTML(j)).filter(function(){return 3!==this.nodeType}),function(d){h.call(this,d)}):(this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:a.id,xhr:c})},this.settings.core.error.call(this,this._data.core.last_error),h.call(this,!1))},this)).fail(H.proxy(function(b){h.call(this,!1),this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:a.id,xhr:b})},this.settings.core.error.call(this,this._data.core.last_error)},this))):(f=H.isArray(g)||H.isPlainObject(g)?JSON.parse(JSON.stringify(g)):g,a.id===H.jstree.root?this._append_json_data(a,f,function(b){h.call(this,b)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_05",reason:"Could not load node",data:JSON.stringify({id:a.id})},this.settings.core.error.call(this,this._data.core.last_error),h.call(this,!1))):"string"==typeof g?a.id===H.jstree.root?this._append_html_data(a,H(H.parseHTML(g)).filter(function(){return 3!==this.nodeType}),function(b){h.call(this,b)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_06",reason:"Could not load node",data:JSON.stringify({id:a.id})},this.settings.core.error.call(this,this._data.core.last_error),h.call(this,!1)):h.call(this,!1):a.id===H.jstree.root?this._append_html_data(a,this._data.core.original_container_html.clone(!0),function(b){h.call(this,b)}):h.call(this,!1)},_node_changed:function(b){b=this.get_node(b),b&&this._model.changed.push(b.id)},_append_html_data:function(Q,P,O){Q=this.get_node(Q),Q.children=[],Q.children_d=[];var N=P.is("ul")?P.children():P,M=Q.id,L=[],K=[],J=this._model.data,I=J[M],q=this._data.core.selected.length,p,o,a;for(N.each(H.proxy(function(d,e){p=this._parse_model_from_html(H(e),M,I.parents.concat()),p&&(L.push(p),K.push(p),J[p].children_d.length&&(K=K.concat(J[p].children_d)))},this)),I.children=L,I.children_d=K,o=0,a=I.parents.length;a>o;o++){J[I.parents[o]].children_d=J[I.parents[o]].children_d.concat(K)}this.trigger("model",{nodes:K,parent:M}),M!==H.jstree.root?(this._node_changed(M),this.redraw()):(this.get_container_ul().children(".jstree-initial-node").remove(),this.redraw(!0)),this._data.core.selected.length!==q&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),O.call(this,!0)},_append_json_data:function(I,q,p,o){if(null!==this.element){I=this.get_node(I),I.children=[],I.children_d=[],q.d&&(q=q.d,"string"==typeof q&&(q=JSON.parse(q))),H.isArray(q)||(q=[q]);var n=null,m={df:this._model.default_state,dat:q,par:I.id,m:this._model.data,t_id:this._id,t_cnt:this._cnt,sel:this._data.core.selected},l=function(ab,aa){ab.data&&(ab=ab.data);var Z=ab.dat,Y=ab.par,X=[],W=[],V=[],U=ab.df,T=ab.t_id,S=ab.t_cnt,R=ab.m,Q=R[Y],P=ab.sel,O,N,M,L,K=function(ah,ag,af){af=af?af.concat():[],ag&&af.unshift(ag);var ae=ah.id.toString(),ad,ac,h,g,b={id:ae,text:ah.text||"",icon:ah.icon!==aa?ah.icon:!0,parent:ag,parents:af,children:ah.children||[],children_d:ah.children_d||[],data:ah.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(ad in U){U.hasOwnProperty(ad)&&(b.state[ad]=U[ad])}if(ah&&ah.data&&ah.data.jstree&&ah.data.jstree.icon&&(b.icon=ah.data.jstree.icon),(b.icon===aa||null===b.icon||""===b.icon)&&(b.icon=!0),ah&&ah.data&&(b.data=ah.data,ah.data.jstree)){for(ad in ah.data.jstree){ah.data.jstree.hasOwnProperty(ad)&&(b.state[ad]=ah.data.jstree[ad])}}if(ah&&"object"==typeof ah.state){for(ad in ah.state){ah.state.hasOwnProperty(ad)&&(b.state[ad]=ah.state[ad])}}if(ah&&"object"==typeof ah.li_attr){for(ad in ah.li_attr){ah.li_attr.hasOwnProperty(ad)&&(b.li_attr[ad]=ah.li_attr[ad])}}if(b.li_attr.id||(b.li_attr.id=ae),ah&&"object"==typeof ah.a_attr){for(ad in ah.a_attr){ah.a_attr.hasOwnProperty(ad)&&(b.a_attr[ad]=ah.a_attr[ad])}}for(ah&&ah.children&&ah.children===!0&&(b.state.loaded=!1,b.children=[],b.children_d=[]),R[b.id]=b,ad=0,ac=b.children.length;ac>ad;ad++){h=K(R[b.children[ad]],b.id,af),g=R[h],b.children_d.push(h),g.children_d.length&&(b.children_d=b.children_d.concat(g.children_d))}return delete ah.data,delete ah.children,R[b.id].original=ah,b.state.selected&&V.push(b.id),b.id},J=function(af,ae,ad){ad=ad?ad.concat():[],ae&&ad.unshift(ae);var ac=!1,j,i,h,g,b;do{ac="j"+T+"_"+ ++S}while(R[ac]);b={id:!1,text:"string"==typeof af?af:"",icon:"object"==typeof af&&af.icon!==aa?af.icon:!0,parent:ae,parents:ad,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(j in U){U.hasOwnProperty(j)&&(b.state[j]=U[j])}if(af&&af.id&&(b.id=af.id.toString()),af&&af.text&&(b.text=af.text),af&&af.data&&af.data.jstree&&af.data.jstree.icon&&(b.icon=af.data.jstree.icon),(b.icon===aa||null===b.icon||""===b.icon)&&(b.icon=!0),af&&af.data&&(b.data=af.data,af.data.jstree)){for(j in af.data.jstree){af.data.jstree.hasOwnProperty(j)&&(b.state[j]=af.data.jstree[j])}}if(af&&"object"==typeof af.state){for(j in af.state){af.state.hasOwnProperty(j)&&(b.state[j]=af.state[j])}}if(af&&"object"==typeof af.li_attr){for(j in af.li_attr){af.li_attr.hasOwnProperty(j)&&(b.li_attr[j]=af.li_attr[j])}}if(b.li_attr.id&&!b.id&&(b.id=b.li_attr.id.toString()),b.id||(b.id=ac),b.li_attr.id||(b.li_attr.id=b.id),af&&"object"==typeof af.a_attr){for(j in af.a_attr){af.a_attr.hasOwnProperty(j)&&(b.a_attr[j]=af.a_attr[j])}}if(af&&af.children&&af.children.length){for(j=0,i=af.children.length;i>j;j++){h=J(af.children[j],b.id,ad),g=R[h],b.children.push(h),g.children_d.length&&(b.children_d=b.children_d.concat(g.children_d))}b.children_d=b.children_d.concat(b.children)}return af&&af.children&&af.children===!0&&(b.state.loaded=!1,b.children=[],b.children_d=[]),delete af.data,delete af.children,b.original=af,R[b.id]=b,b.state.selected&&V.push(b.id),b.id};if(Z.length&&Z[0].id!==aa&&Z[0].parent!==aa){for(N=0,M=Z.length;M>N;N++){Z[N].children||(Z[N].children=[]),R[Z[N].id.toString()]=Z[N]}for(N=0,M=Z.length;M>N;N++){R[Z[N].parent.toString()].children.push(Z[N].id.toString()),Q.children_d.push(Z[N].id.toString())}for(N=0,M=Q.children.length;M>N;N++){O=K(R[Q.children[N]],Y,Q.parents.concat()),W.push(O),R[O].children_d.length&&(W=W.concat(R[O].children_d))}for(N=0,M=Q.parents.length;M>N;N++){R[Q.parents[N]].children_d=R[Q.parents[N]].children_d.concat(W)}L={cnt:S,mod:R,sel:P,par:Y,dpc:W,add:V}}else{for(N=0,M=Z.length;M>N;N++){O=J(Z[N],Y,Q.parents.concat()),O&&(X.push(O),W.push(O),R[O].children_d.length&&(W=W.concat(R[O].children_d)))}for(Q.children=X,Q.children_d=W,N=0,M=Q.parents.length;M>N;N++){R[Q.parents[N]].children_d=R[Q.parents[N]].children_d.concat(W)}L={cnt:S,mod:R,sel:P,par:Y,dpc:W,add:V}}return"undefined"!=typeof window&&"undefined"!=typeof window.document?L:void postMessage(L)},k=function(d,P){if(null!==this.element){if(this._cnt=d.cnt,this._model.data=d.mod,P){var O,N,M=d.add,L=d.sel,K=this._data.core.selected.slice(),J=this._model.data;if(L.length!==K.length||H.vakata.array_unique(L.concat(K)).length!==L.length){for(O=0,N=L.length;N>O;O++){-1===H.inArray(L[O],M)&&-1===H.inArray(L[O],K)&&(J[L[O]].state.selected=!1)}for(O=0,N=K.length;N>O;O++){-1===H.inArray(K[O],L)&&(J[K[O]].state.selected=!0)}}}d.add.length&&(this._data.core.selected=this._data.core.selected.concat(d.add)),this.trigger("model",{nodes:d.dpc,parent:d.par}),d.par!==H.jstree.root?(this._node_changed(d.par),this.redraw()):this.redraw(!0),d.add.length&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),p.call(this,!0)}};if(this.settings.core.worker&&window.Blob&&window.URL&&window.Worker){try{null===this._wrk&&(this._wrk=window.URL.createObjectURL(new window.Blob(["self.onmessage = "+l.toString()],{type:"text/javascript"}))),!this._data.core.working||o?(this._data.core.working=!0,n=new window.Worker(this._wrk),n.onmessage=H.proxy(function(d){k.call(this,d.data,!0);try{n.terminate(),n=null}catch(c){}this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1},this),m.par?n.postMessage(m):this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1):this._data.core.worker_queue.push([I,q,p,!0])}catch(a){k.call(this,l(m),!1),this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1}}else{k.call(this,l(m),!1)}}},_parse_model_from_html:function(K,J,I){I=I?[].concat(I):[],J&&I.unshift(J);var q,p,o=this._model.data,n={id:!1,text:!1,icon:!0,parent:J,parents:I,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1},m,b,a;for(m in this._model.default_state){this._model.default_state.hasOwnProperty(m)&&(n.state[m]=this._model.default_state[m])}if(b=H.vakata.attributes(K,!0),H.each(b,function(d,e){return e=H.trim(e),e.length?(n.li_attr[d]=e,void ("id"===d&&(n.id=e.toString()))):!0}),b=K.children("a").first(),b.length&&(b=H.vakata.attributes(b,!0),H.each(b,function(d,e){e=H.trim(e),e.length&&(n.a_attr[d]=e)})),b=K.children("a").first().length?K.children("a").first().clone():K.clone(),b.children("ins, i, ul").remove(),b=b.html(),b=H("<div />").html(b),n.text=this.settings.core.force_text?b.text():b.html(),b=K.data(),n.data=b?H.extend(!0,{},b):null,n.state.opened=K.hasClass("jstree-open"),n.state.selected=K.children("a").hasClass("jstree-clicked"),n.state.disabled=K.children("a").hasClass("jstree-disabled"),n.data&&n.data.jstree){for(m in n.data.jstree){n.data.jstree.hasOwnProperty(m)&&(n.state[m]=n.data.jstree[m])}}b=K.children("a").children(".jstree-themeicon"),b.length&&(n.icon=b.hasClass("jstree-themeicon-hidden")?!1:b.attr("rel")),n.state.icon!==G&&(n.icon=n.state.icon),(n.icon===G||null===n.icon||""===n.icon)&&(n.icon=!0),b=K.children("ul").children("li");do{a="j"+this._id+"_"+ ++this._cnt}while(o[a]);return n.id=n.li_attr.id?n.li_attr.id.toString():a,b.length?(b.each(H.proxy(function(d,e){q=this._parse_model_from_html(H(e),n.id,I),p=this._model.data[q],n.children.push(q),p.children_d.length&&(n.children_d=n.children_d.concat(p.children_d))},this)),n.children_d=n.children_d.concat(n.children)):K.hasClass("jstree-closed")&&(n.state.loaded=!1),n.li_attr["class"]&&(n.li_attr["class"]=n.li_attr["class"].replace("jstree-closed","").replace("jstree-open","")),n.a_attr["class"]&&(n.a_attr["class"]=n.a_attr["class"].replace("jstree-clicked","").replace("jstree-disabled","")),o[n.id]=n,n.state.selected&&this._data.core.selected.push(n.id),n.id},_parse_model_from_flat_json:function(M,L,K){K=K?K.concat():[],L&&K.unshift(L);var J=M.id.toString(),I=this._model.data,q=this._model.default_state,p,o,n,m,b={id:J,text:M.text||"",icon:M.icon!==G?M.icon:!0,parent:L,parents:K,children:M.children||[],children_d:M.children_d||[],data:M.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(p in q){q.hasOwnProperty(p)&&(b.state[p]=q[p])}if(M&&M.data&&M.data.jstree&&M.data.jstree.icon&&(b.icon=M.data.jstree.icon),(b.icon===G||null===b.icon||""===b.icon)&&(b.icon=!0),M&&M.data&&(b.data=M.data,M.data.jstree)){for(p in M.data.jstree){M.data.jstree.hasOwnProperty(p)&&(b.state[p]=M.data.jstree[p])}}if(M&&"object"==typeof M.state){for(p in M.state){M.state.hasOwnProperty(p)&&(b.state[p]=M.state[p])}}if(M&&"object"==typeof M.li_attr){for(p in M.li_attr){M.li_attr.hasOwnProperty(p)&&(b.li_attr[p]=M.li_attr[p])}}if(b.li_attr.id||(b.li_attr.id=J),M&&"object"==typeof M.a_attr){for(p in M.a_attr){M.a_attr.hasOwnProperty(p)&&(b.a_attr[p]=M.a_attr[p])}}for(M&&M.children&&M.children===!0&&(b.state.loaded=!1,b.children=[],b.children_d=[]),I[b.id]=b,p=0,o=b.children.length;o>p;p++){n=this._parse_model_from_flat_json(I[b.children[p]],b.id,K),m=I[n],b.children_d.push(n),m.children_d.length&&(b.children_d=b.children_d.concat(m.children_d))}return delete M.data,delete M.children,I[b.id].original=M,b.state.selected&&this._data.core.selected.push(b.id),b.id},_parse_model_from_json:function(M,L,K){K=K?K.concat():[],L&&K.unshift(L);var J=!1,I,q,p,o,n=this._model.data,m=this._model.default_state,b;do{J="j"+this._id+"_"+ ++this._cnt}while(n[J]);b={id:!1,text:"string"==typeof M?M:"",icon:"object"==typeof M&&M.icon!==G?M.icon:!0,parent:L,parents:K,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(I in m){m.hasOwnProperty(I)&&(b.state[I]=m[I])}if(M&&M.id&&(b.id=M.id.toString()),M&&M.text&&(b.text=M.text),M&&M.data&&M.data.jstree&&M.data.jstree.icon&&(b.icon=M.data.jstree.icon),(b.icon===G||null===b.icon||""===b.icon)&&(b.icon=!0),M&&M.data&&(b.data=M.data,M.data.jstree)){for(I in M.data.jstree){M.data.jstree.hasOwnProperty(I)&&(b.state[I]=M.data.jstree[I])}}if(M&&"object"==typeof M.state){for(I in M.state){M.state.hasOwnProperty(I)&&(b.state[I]=M.state[I])}}if(M&&"object"==typeof M.li_attr){for(I in M.li_attr){M.li_attr.hasOwnProperty(I)&&(b.li_attr[I]=M.li_attr[I])}}if(b.li_attr.id&&!b.id&&(b.id=b.li_attr.id.toString()),b.id||(b.id=J),b.li_attr.id||(b.li_attr.id=b.id),M&&"object"==typeof M.a_attr){for(I in M.a_attr){M.a_attr.hasOwnProperty(I)&&(b.a_attr[I]=M.a_attr[I])}}if(M&&M.children&&M.children.length){for(I=0,q=M.children.length;q>I;I++){p=this._parse_model_from_json(M.children[I],b.id,K),o=n[p],b.children.push(p),o.children_d.length&&(b.children_d=b.children_d.concat(o.children_d))}b.children_d=b.children_d.concat(b.children)}return M&&M.children&&M.children===!0&&(b.state.loaded=!1,b.children=[],b.children_d=[]),delete M.data,delete M.children,b.original=M,n[b.id]=b,b.state.selected&&this._data.core.selected.push(b.id),b.id},_redraw:function(){var a=this._model.force_full_redraw?this._model.data[H.jstree.root].children.concat([]):this._model.changed.concat([]),l=z.createElement("UL"),k,j,i,h=this._data.core.focused;for(j=0,i=a.length;i>j;j++){k=this.redraw_node(a[j],!0,this._model.force_full_redraw),k&&this._model.force_full_redraw&&l.appendChild(k)}this._model.force_full_redraw&&(l.className=this.get_container_ul()[0].className,l.setAttribute("role","group"),this.element.empty().append(l)),null!==h&&(k=this.get_node(h,!0),k&&k.length&&k.children(".jstree-anchor")[0]!==z.activeElement?k.children(".jstree-anchor").focus():this._data.core.focused=null),this._model.force_full_redraw=!1,this._model.changed=[],this.trigger("redraw",{nodes:a})},redraw:function(b){b&&(this._model.force_full_redraw=!0),this._redraw()},draw_children:function(a){var l=this.get_node(a),k=!1,j=!1,i=!1,h=z;if(!l){return !1}if(l.id===H.jstree.root){return this.redraw(!0)}if(a=this.get_node(a,!0),!a||!a.length){return !1}if(a.children(".jstree-children").remove(),a=a[0],l.children.length&&l.state.loaded){for(i=h.createElement("UL"),i.setAttribute("role","group"),i.className="jstree-children",k=0,j=l.children.length;j>k;k++){i.appendChild(this.redraw_node(l.children[k],!0,!0))}a.appendChild(i)}},redraw_node:function(Z,Y,X,W){var V=this.get_node(Z),U=!1,T=!1,S=!1,R=!1,Q=!1,P=!1,O="",N=z,M=this._model.data,L=!1,K=!1,J=null,I=0,j=0,i=!1,a=!1;if(!V){return !1}if(V.id===H.jstree.root){return this.redraw(!0)}if(Y=Y||0===V.children.length,Z=z.querySelector?this.element[0].querySelector("#"+(-1!=="0123456789".indexOf(V.id[0])?"\\3"+V.id[0]+" "+V.id.substr(1).replace(H.jstree.idregex,"\\$&"):V.id.replace(H.jstree.idregex,"\\$&"))):z.getElementById(V.id)){Z=H(Z),X||(U=Z.parent().parent()[0],U===this.element[0]&&(U=null),T=Z.index()),Y||!V.children.length||Z.children(".jstree-children").length||(Y=!0),Y||(S=Z.children(".jstree-children")[0]),L=Z.children(".jstree-anchor")[0]===z.activeElement,Z.remove()}else{if(Y=!0,!X){if(U=V.parent!==H.jstree.root?H("#"+V.parent.replace(H.jstree.idregex,"\\$&"),this.element)[0]:null,!(null===U||U&&M[V.parent].state.opened)){return !1}T=H.inArray(V.id,null===U?M[H.jstree.root].children:M[V.parent].children)}}Z=y.cloneNode(!0),O="jstree-node ";for(R in V.li_attr){if(V.li_attr.hasOwnProperty(R)){if("id"===R){continue}"class"!==R?Z.setAttribute(R,V.li_attr[R]):O+=V.li_attr[R]}}for(V.a_attr.id||(V.a_attr.id=V.id+"_anchor"),Z.setAttribute("aria-selected",!!V.state.selected),Z.setAttribute("aria-level",V.parents.length),Z.setAttribute("aria-labelledby",V.a_attr.id),V.state.disabled&&Z.setAttribute("aria-disabled",!0),R=0,Q=V.children.length;Q>R;R++){if(!M[V.children[R]].state.hidden){i=!0;break}}if(null!==V.parent&&M[V.parent]&&!V.state.hidden&&(R=H.inArray(V.id,M[V.parent].children),a=V.id,-1!==R)){for(R++,Q=M[V.parent].children.length;Q>R;R++){if(M[M[V.parent].children[R]].state.hidden||(a=M[V.parent].children[R]),a!==V.id){break}}}V.state.hidden&&(O+=" jstree-hidden"),V.state.loaded&&!i?O+=" jstree-leaf":(O+=V.state.opened&&V.state.loaded?" jstree-open":" jstree-closed",Z.setAttribute("aria-expanded",V.state.opened&&V.state.loaded)),a===V.id&&(O+=" jstree-last"),Z.id=V.id,Z.className=O,O=(V.state.selected?" jstree-clicked":"")+(V.state.disabled?" jstree-disabled":"");for(Q in V.a_attr){if(V.a_attr.hasOwnProperty(Q)){if("href"===Q&&"#"===V.a_attr[Q]){continue}"class"!==Q?Z.childNodes[1].setAttribute(Q,V.a_attr[Q]):O+=" "+V.a_attr[Q]}}if(O.length&&(Z.childNodes[1].className="jstree-anchor "+O),(V.icon&&V.icon!==!0||V.icon===!1)&&(V.icon===!1?Z.childNodes[1].childNodes[0].className+=" jstree-themeicon-hidden":-1===V.icon.indexOf("/")&&-1===V.icon.indexOf(".")?Z.childNodes[1].childNodes[0].className+=" "+V.icon+" jstree-themeicon-custom":(Z.childNodes[1].childNodes[0].style.backgroundImage="url("+V.icon+")",Z.childNodes[1].childNodes[0].style.backgroundPosition="center center",Z.childNodes[1].childNodes[0].style.backgroundSize="auto",Z.childNodes[1].childNodes[0].className+=" jstree-themeicon-custom")),this.settings.core.force_text?Z.childNodes[1].appendChild(N.createTextNode(V.text)):Z.childNodes[1].innerHTML+=V.text,Y&&V.children.length&&(V.state.opened||W)&&V.state.loaded){for(P=N.createElement("UL"),P.setAttribute("role","group"),P.className="jstree-children",R=0,Q=V.children.length;Q>R;R++){P.appendChild(this.redraw_node(V.children[R],Y,!0))}Z.appendChild(P)}if(S&&Z.appendChild(S),!X){for(U||(U=this.element[0]),R=0,Q=U.childNodes.length;Q>R;R++){if(U.childNodes[R]&&U.childNodes[R].className&&-1!==U.childNodes[R].className.indexOf("jstree-children")){J=U.childNodes[R];break}}J||(J=N.createElement("UL"),J.setAttribute("role","group"),J.className="jstree-children",U.appendChild(J)),U=J,T<U.childNodes.length?U.insertBefore(Z,U.childNodes[T]):U.appendChild(Z),L&&(I=this.element[0].scrollTop,j=this.element[0].scrollLeft,Z.childNodes[1].focus(),this.element[0].scrollTop=I,this.element[0].scrollLeft=j)}return V.state.opened&&!V.state.loaded&&(V.state.opened=!1,setTimeout(H.proxy(function(){this.open_node(V.id,!1,0)},this),0)),Z},open_node:function(n,m,l){var k,j,b,a;if(H.isArray(n)){for(n=n.slice(),k=0,j=n.length;j>k;k++){this.open_node(n[k],m,l)}return !0}return n=this.get_node(n),n&&n.id!==H.jstree.root?(l=l===G?this.settings.core.animation:l,this.is_closed(n)?this.is_loaded(n)?(b=this.get_node(n,!0),a=this,b.length&&(l&&b.children(".jstree-children").length&&b.children(".jstree-children").stop(!0,!0),n.children.length&&!this._firstChild(b.children(".jstree-children")[0])&&this.draw_children(n),l?(this.trigger("before_open",{node:n}),b.children(".jstree-children").css("display","none").end().removeClass("jstree-closed").addClass("jstree-open").attr("aria-expanded",!0).children(".jstree-children").stop(!0,!0).slideDown(l,function(){this.style.display="",a.trigger("after_open",{node:n})})):(this.trigger("before_open",{node:n}),b[0].className=b[0].className.replace("jstree-closed","jstree-open"),b[0].setAttribute("aria-expanded",!0))),n.state.opened=!0,m&&m.call(this,n,!0),b.length||this.trigger("before_open",{node:n}),this.trigger("open_node",{node:n}),l&&b.length||this.trigger("after_open",{node:n}),!0):this.is_loading(n)?setTimeout(H.proxy(function(){this.open_node(n,m,l)},this),500):void this.load_node(n,function(d,c){return c?this.open_node(d,m,l):m?m.call(this,d,!1):!1}):(m&&m.call(this,n,!1),!1)):!1},_open_to:function(a){if(a=this.get_node(a),!a||a.id===H.jstree.root){return !1}var h,g,f=a.parents;for(h=0,g=f.length;g>h;h+=1){h!==H.jstree.root&&this.open_node(f[h],!1,0)}return H("#"+a.id.replace(H.jstree.idregex,"\\$&"),this.element)},close_node:function(l,k){var j,i,b,a;if(H.isArray(l)){for(l=l.slice(),j=0,i=l.length;i>j;j++){this.close_node(l[j],k)}return !0}return l=this.get_node(l),l&&l.id!==H.jstree.root?this.is_closed(l)?!1:(k=k===G?this.settings.core.animation:k,b=this,a=this.get_node(l,!0),a.length&&(k?a.children(".jstree-children").attr("style","display:block !important").end().removeClass("jstree-open").addClass("jstree-closed").attr("aria-expanded",!1).children(".jstree-children").stop(!0,!0).slideUp(k,function(){this.style.display="",a.children(".jstree-children").remove(),b.trigger("after_close",{node:l})}):(a[0].className=a[0].className.replace("jstree-open","jstree-closed"),a.attr("aria-expanded",!1).children(".jstree-children").remove())),l.state.opened=!1,this.trigger("close_node",{node:l}),void (k&&a.length||this.trigger("after_close",{node:l}))):!1},toggle_node:function(a){var f,e;if(H.isArray(a)){for(a=a.slice(),f=0,e=a.length;e>f;f++){this.toggle_node(a[f])}return !0}return this.is_closed(a)?this.open_node(a):this.is_open(a)?this.close_node(a):void 0},open_all:function(a,n,m){if(a||(a=H.jstree.root),a=this.get_node(a),!a){return !1}var l=a.id===H.jstree.root?this.get_container_ul():this.get_node(a,!0),k,j,i;if(!l.length){for(k=0,j=a.children_d.length;j>k;k++){this.is_closed(this._model.data[a.children_d[k]])&&(this._model.data[a.children_d[k]].state.opened=!0)}return this.trigger("open_all",{node:a})}m=m||l,i=this,l=this.is_closed(a)?l.find(".jstree-closed").addBack():l.find(".jstree-closed"),l.each(function(){i.open_node(this,function(d,c){c&&this.is_parent(d)&&this.open_all(d,n,m)},n||0)}),0===m.find(".jstree-closed").length&&this.trigger("open_all",{node:this.get_node(m)})},close_all:function(a,l){if(a||(a=H.jstree.root),a=this.get_node(a),!a){return !1}var k=a.id===H.jstree.root?this.get_container_ul():this.get_node(a,!0),j=this,i,h;for(k.length&&(k=this.is_open(a)?k.find(".jstree-open").addBack():k.find(".jstree-open"),H(k.get().reverse()).each(function(){j.close_node(this,l||0)})),i=0,h=a.children_d.length;h>i;i++){this._model.data[a.children_d[i]].state.opened=!1}this.trigger("close_all",{node:a})},is_disabled:function(b){return b=this.get_node(b),b&&b.state&&b.state.disabled},enable_node:function(a){var f,e;if(H.isArray(a)){for(a=a.slice(),f=0,e=a.length;e>f;f++){this.enable_node(a[f])}return !0}return a=this.get_node(a),a&&a.id!==H.jstree.root?(a.state.disabled=!1,this.get_node(a,!0).children(".jstree-anchor").removeClass("jstree-disabled").attr("aria-disabled",!1),void this.trigger("enable_node",{node:a})):!1},disable_node:function(a){var f,e;if(H.isArray(a)){for(a=a.slice(),f=0,e=a.length;e>f;f++){this.disable_node(a[f])}return !0}return a=this.get_node(a),a&&a.id!==H.jstree.root?(a.state.disabled=!0,this.get_node(a,!0).children(".jstree-anchor").addClass("jstree-disabled").attr("aria-disabled",!0),void this.trigger("disable_node",{node:a})):!1},hide_node:function(a,h){var g,f;if(H.isArray(a)){for(a=a.slice(),g=0,f=a.length;f>g;g++){this.hide_node(a[g],!0)}return this.redraw(),!0}return a=this.get_node(a),a&&a.id!==H.jstree.root?void (a.state.hidden||(a.state.hidden=!0,this._node_changed(a.parent),h||this.redraw(),this.trigger("hide_node",{node:a}))):!1},show_node:function(a,h){var g,f;if(H.isArray(a)){for(a=a.slice(),g=0,f=a.length;f>g;g++){this.show_node(a[g],!0)}return this.redraw(),!0}return a=this.get_node(a),a&&a.id!==H.jstree.root?void (a.state.hidden&&(a.state.hidden=!1,this._node_changed(a.parent),h||this.redraw(),this.trigger("show_node",{node:a}))):!1},hide_all:function(a){var h,g=this._model.data,f=[];for(h in g){g.hasOwnProperty(h)&&h!==H.jstree.root&&!g[h].state.hidden&&(g[h].state.hidden=!0,f.push(h))}return this._model.force_full_redraw=!0,a||this.redraw(),this.trigger("hide_all",{nodes:f}),f},show_all:function(a){var h,g=this._model.data,f=[];for(h in g){g.hasOwnProperty(h)&&h!==H.jstree.root&&g[h].state.hidden&&(g[h].state.hidden=!1,f.push(h))}return this._model.force_full_redraw=!0,a||this.redraw(),this.trigger("show_all",{nodes:f}),f},activate_node:function(b,p){if(this.is_disabled(b)){return !1}if(p&&"object"==typeof p||(p={}),this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==G?this.get_node(this._data.core.last_clicked.id):null,this._data.core.last_clicked&&!this._data.core.last_clicked.state.selected&&(this._data.core.last_clicked=null),!this._data.core.last_clicked&&this._data.core.selected.length&&(this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1])),this.settings.core.multiple&&(p.metaKey||p.ctrlKey||p.shiftKey)&&(!p.shiftKey||this._data.core.last_clicked&&this.get_parent(b)&&this.get_parent(b)===this._data.core.last_clicked.parent)){if(p.shiftKey){var o=this.get_node(b).id,n=this._data.core.last_clicked.id,m=this.get_node(this._data.core.last_clicked.parent).children,l=!1,k,j;for(k=0,j=m.length;j>k;k+=1){m[k]===o&&(l=!l),m[k]===n&&(l=!l),this.is_disabled(m[k])||!l&&m[k]!==o&&m[k]!==n?this.deselect_node(m[k],!0,p):this.select_node(m[k],!0,!1,p)}this.trigger("changed",{action:"select_node",node:this.get_node(b),selected:this._data.core.selected,event:p})}else{this.is_selected(b)?this.deselect_node(b,!1,p):this.select_node(b,!1,!1,p)}}else{!this.settings.core.multiple&&(p.metaKey||p.ctrlKey||p.shiftKey)&&this.is_selected(b)?this.deselect_node(b,!1,p):(this.deselect_all(!0),this.select_node(b,!1,!1,p),this._data.core.last_clicked=this.get_node(b))}this.trigger("activate_node",{node:this.get_node(b),event:p})},hover_node:function(e){if(e=this.get_node(e,!0),!e||!e.length||e.children(".jstree-hovered").length){return !1}var d=this.element.find(".jstree-hovered"),f=this.element;d&&d.length&&this.dehover_node(d),e.children(".jstree-anchor").addClass("jstree-hovered"),this.trigger("hover_node",{node:this.get_node(e)}),setTimeout(function(){f.attr("aria-activedescendant",e[0].id)},0)},dehover_node:function(b){return b=this.get_node(b,!0),b&&b.length&&b.children(".jstree-hovered").length?(b.children(".jstree-anchor").removeClass("jstree-hovered"),void this.trigger("dehover_node",{node:this.get_node(b)})):!1},select_node:function(a,p,o,n){var m,l,k,j;if(H.isArray(a)){for(a=a.slice(),l=0,k=a.length;k>l;l++){this.select_node(a[l],p,o,n)}return !0}return a=this.get_node(a),a&&a.id!==H.jstree.root?(m=this.get_node(a,!0),void (a.state.selected||(a.state.selected=!0,this._data.core.selected.push(a.id),o||(m=this._open_to(a)),m&&m.length&&m.attr("aria-selected",!0).children(".jstree-anchor").addClass("jstree-clicked"),this.trigger("select_node",{node:a,selected:this._data.core.selected,event:n}),p||this.trigger("changed",{action:"select_node",node:a,selected:this._data.core.selected,event:n})))):!1},deselect_node:function(a,l,k){var j,i,h;if(H.isArray(a)){for(a=a.slice(),j=0,i=a.length;i>j;j++){this.deselect_node(a[j],l,k)}return !0}return a=this.get_node(a),a&&a.id!==H.jstree.root?(h=this.get_node(a,!0),void (a.state.selected&&(a.state.selected=!1,this._data.core.selected=H.vakata.array_remove_item(this._data.core.selected,a.id),h.length&&h.attr("aria-selected",!1).children(".jstree-anchor").removeClass("jstree-clicked"),this.trigger("deselect_node",{node:a,selected:this._data.core.selected,event:k}),l||this.trigger("changed",{action:"deselect_node",node:a,selected:this._data.core.selected,event:k})))):!1},select_all:function(a){var h=this._data.core.selected.concat([]),g,f;for(this._data.core.selected=this._model.data[H.jstree.root].children_d.concat(),g=0,f=this._data.core.selected.length;f>g;g++){this._model.data[this._data.core.selected[g]]&&(this._model.data[this._data.core.selected[g]].state.selected=!0)}this.redraw(!0),this.trigger("select_all",{selected:this._data.core.selected}),a||this.trigger("changed",{action:"select_all",selected:this._data.core.selected,old_selection:h})},deselect_all:function(f){var e=this._data.core.selected.concat([]),h,g;for(h=0,g=this._data.core.selected.length;g>h;h++){this._model.data[this._data.core.selected[h]]&&(this._model.data[this._data.core.selected[h]].state.selected=!1)}this._data.core.selected=[],this.element.find(".jstree-clicked").removeClass("jstree-clicked").parent().attr("aria-selected",!1),this.trigger("deselect_all",{selected:this._data.core.selected,node:e}),f||this.trigger("changed",{action:"deselect_all",selected:this._data.core.selected,old_selection:e})},is_selected:function(a){return a=this.get_node(a),a&&a.id!==H.jstree.root?a.state.selected:!1},get_selected:function(a){return a?H.map(this._data.core.selected,H.proxy(function(b){return this.get_node(b)},this)):this._data.core.selected.slice()},get_top_selected:function(a){var n=this.get_selected(!0),m={},l,k,j,i;for(l=0,k=n.length;k>l;l++){m[n[l].id]=n[l]}for(l=0,k=n.length;k>l;l++){for(j=0,i=n[l].children_d.length;i>j;j++){m[n[l].children_d[j]]&&delete m[n[l].children_d[j]]}}n=[];for(l in m){m.hasOwnProperty(l)&&n.push(l)}return a?H.map(n,H.proxy(function(b){return this.get_node(b)},this)):n},get_bottom_selected:function(a){var j=this.get_selected(!0),i=[],h,g;for(h=0,g=j.length;g>h;h++){j[h].children.length||i.push(j[h].id)}return a?H.map(i,H.proxy(function(b){return this.get_node(b)},this)):i},get_state:function(){var a={core:{open:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},selected:[]}},d;for(d in this._model.data){this._model.data.hasOwnProperty(d)&&d!==H.jstree.root&&(this._model.data[d].state.opened&&a.core.open.push(d),this._model.data[d].state.selected&&a.core.selected.push(d))}return a},set_state:function(n,m){if(n){if(n.core){var l,k,j,b,a;if(n.core.open){return H.isArray(n.core.open)&&n.core.open.length?this._load_nodes(n.core.open,function(c){this.open_node(c,!1,0),delete n.core.open,this.set_state(n,m)},!0):(delete n.core.open,this.set_state(n,m)),!1}if(n.core.scroll){return n.core.scroll&&n.core.scroll.left!==G&&this.element.scrollLeft(n.core.scroll.left),n.core.scroll&&n.core.scroll.top!==G&&this.element.scrollTop(n.core.scroll.top),delete n.core.scroll,this.set_state(n,m),!1}if(n.core.selected){return b=this,this.deselect_all(),H.each(n.core.selected,function(d,c){b.select_node(c,!1,!0)}),delete n.core.selected,this.set_state(n,m),!1}for(a in n){n.hasOwnProperty(a)&&"core"!==a&&-1===H.inArray(a,this.settings.plugins)&&delete n[a]}if(H.isEmptyObject(n.core)){return delete n.core,this.set_state(n,m),!1}}return H.isEmptyObject(n)?(n=null,m&&m.call(this),this.trigger("set_state"),!1):!0}return !1},refresh:function(a,f){this._data.core.state=f===!0?{}:this.get_state(),f&&H.isFunction(f)&&(this._data.core.state=f.call(this,this._data.core.state)),this._cnt=0,this._model.data={},this._model.data[H.jstree.root]={id:H.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}},this._data.core.selected=[],this._data.core.last_clicked=null,this._data.core.focused=null;var e=this.get_container_ul()[0].className;a||(this.element.html("<ul class='"+e+"' role='group'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='treeitem' id='j"+this._id+"_loading'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading")),this.load_node(H.jstree.root,function(d,g){g&&(this.get_container_ul()[0].className=e,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.set_state(H.extend(!0,{},this._data.core.state),function(){this.trigger("refresh")})),this._data.core.state=null})},refresh_node:function(a){if(a=this.get_node(a),!a||a.id===H.jstree.root){return !1}var h=[],g=[],f=this._data.core.selected.concat([]);g.push(a.id),a.state.opened===!0&&h.push(a.id),this.get_node(a,!0).find(".jstree-open").each(function(){h.push(this.id)}),this._load_nodes(g,H.proxy(function(b){this.open_node(h,!1,0),this.select_node(this._data.core.selected),this.trigger("refresh_node",{node:a,nodes:b})},this))},set_id:function(a,j){if(a=this.get_node(a),!a||a.id===H.jstree.root){return !1}var i,h,g=this._model.data;for(j=j.toString(),g[a.parent].children[H.inArray(a.id,g[a.parent].children)]=j,i=0,h=a.parents.length;h>i;i++){g[a.parents[i]].children_d[H.inArray(a.id,g[a.parents[i]].children_d)]=j}for(i=0,h=a.children.length;h>i;i++){g[a.children[i]].parent=j}for(i=0,h=a.children_d.length;h>i;i++){g[a.children_d[i]].parents[H.inArray(a.id,g[a.children_d[i]].parents)]=j}return i=H.inArray(a.id,this._data.core.selected),-1!==i&&(this._data.core.selected[i]=j),i=this.get_node(a.id,!0),i&&(i.attr("id",j).children(".jstree-anchor").attr("id",j+"_anchor").end().attr("aria-labelledby",j+"_anchor"),this.element.attr("aria-activedescendant")===a.id&&this.element.attr("aria-activedescendant",j)),delete g[a.id],a.id=j,a.li_attr.id=j,g[j]=a,!0},get_text:function(a){return a=this.get_node(a),a&&a.id!==H.jstree.root?a.text:!1},set_text:function(a,h){var g,f;if(H.isArray(a)){for(a=a.slice(),g=0,f=a.length;f>g;g++){this.set_text(a[g],h)}return !0}return a=this.get_node(a),a&&a.id!==H.jstree.root?(a.text=h,this.get_node(a,!0).length&&this.redraw_node(a.id),this.trigger("set_text",{obj:a,text:h}),!0):!1},get_json:function(a,l,k){if(a=this.get_node(a||H.jstree.root),!a){return !1}l&&l.flat&&!k&&(k=[]);var j={id:a.id,text:a.text,icon:this.get_icon(a),li_attr:H.extend(!0,{},a.li_attr),a_attr:H.extend(!0,{},a.a_attr),state:{},data:l&&l.no_data?!1:H.extend(!0,{},a.data)},i,h;if(l&&l.flat?j.parent=a.parent:j.children=[],!l||!l.no_state){for(i in a.state){a.state.hasOwnProperty(i)&&(j.state[i]=a.state[i])}}if(l&&l.no_id&&(delete j.id,j.li_attr&&j.li_attr.id&&delete j.li_attr.id,j.a_attr&&j.a_attr.id&&delete j.a_attr.id),l&&l.flat&&a.id!==H.jstree.root&&k.push(j),!l||!l.no_children){for(i=0,h=a.children.length;h>i;i++){l&&l.flat?this.get_json(a.children[i],l,k):j.children.push(this.get_json(a.children[i],l))}}return l&&l.flat?k:a.id===H.jstree.root?j.children:j},create_node:function(I,q,p,o,n){if(null===I&&(I=H.jstree.root),I=this.get_node(I),!I){return !1}if(p=p===G?"last":p,!p.toString().match(/^(before|after)$/)&&!n&&!this.is_loaded(I)){return this.load_node(I,function(){this.create_node(I,q,p,o,!0)})}q||(q={text:this.get_string("New node")}),"string"==typeof q&&(q={text:q}),q.text===G&&(q.text=this.get_string("New node"));var m,l,b,a;switch(I.id===H.jstree.root&&("before"===p&&(p="first"),"after"===p&&(p="last")),p){case"before":m=this.get_node(I.parent),p=H.inArray(I.id,m.children),I=m;break;case"after":m=this.get_node(I.parent),p=H.inArray(I.id,m.children)+1,I=m;break;case"inside":case"first":p=0;break;case"last":p=I.children.length;break;default:p||(p=0)}if(p>I.children.length&&(p=I.children.length),q.id||(q.id=!0),!this.check("create_node",q,I,p)){return this.settings.core.error.call(this,this._data.core.last_error),!1}if(q.id===!0&&delete q.id,q=this._parse_model_from_json(q,I.id,I.parents.concat()),!q){return !1}for(m=this.get_node(q),l=[],l.push(q),l=l.concat(m.children_d),this.trigger("model",{nodes:l,parent:I.id}),I.children_d=I.children_d.concat(l),b=0,a=I.parents.length;a>b;b++){this._model.data[I.parents[b]].children_d=this._model.data[I.parents[b]].children_d.concat(l)}for(q=m,m=[],b=0,a=I.children.length;a>b;b++){m[b>=p?b+1:b]=I.children[b]}return m[p]=q.id,I.children=m,this.redraw_node(I,!0),o&&o.call(this,this.get_node(q)),this.trigger("create_node",{node:this.get_node(q),parent:I.id,position:p}),q.id},rename_node:function(a,j){var i,h,g;if(H.isArray(a)){for(a=a.slice(),i=0,h=a.length;h>i;i++){this.rename_node(a[i],j)}return !0}return a=this.get_node(a),a&&a.id!==H.jstree.root?(g=a.text,this.check("rename_node",a,this.get_parent(a),j)?(this.set_text(a,j),this.trigger("rename_node",{node:a,text:j,old:g}),!0):(this.settings.core.error.call(this,this._data.core.last_error),!1)):!1},delete_node:function(Q){var P,O,N,M,L,K,J,I,q,p,o,a;if(H.isArray(Q)){for(Q=Q.slice(),P=0,O=Q.length;O>P;P++){this.delete_node(Q[P])}return !0}if(Q=this.get_node(Q),!Q||Q.id===H.jstree.root){return !1}if(N=this.get_node(Q.parent),M=H.inArray(Q.id,N.children),p=!1,!this.check("delete_node",Q,N,M)){return this.settings.core.error.call(this,this._data.core.last_error),!1}for(-1!==M&&(N.children=H.vakata.array_remove(N.children,M)),L=Q.children_d.concat([]),L.push(Q.id),I=0,q=L.length;q>I;I++){for(K=0,J=Q.parents.length;J>K;K++){M=H.inArray(L[I],this._model.data[Q.parents[K]].children_d),-1!==M&&(this._model.data[Q.parents[K]].children_d=H.vakata.array_remove(this._model.data[Q.parents[K]].children_d,M))}this._model.data[L[I]].state.selected&&(p=!0,M=H.inArray(L[I],this._data.core.selected),-1!==M&&(this._data.core.selected=H.vakata.array_remove(this._data.core.selected,M)))}for(this.trigger("delete_node",{node:Q,parent:N.id}),p&&this.trigger("changed",{action:"delete_node",node:Q,selected:this._data.core.selected,parent:N.id}),I=0,q=L.length;q>I;I++){delete this._model.data[L[I]]}return -1!==H.inArray(this._data.core.focused,L)&&(this._data.core.focused=null,o=this.element[0].scrollTop,a=this.element[0].scrollLeft,N.id===H.jstree.root?this.get_node(this._model.data[H.jstree.root].children[0],!0).children(".jstree-anchor").focus():this.get_node(N,!0).children(".jstree-anchor").focus(),this.element[0].scrollTop=o,this.element[0].scrollLeft=a),this.redraw_node(N,!0),!0},check:function(a,n,m,l,k){n=n&&n.id?n:this.get_node(n),m=m&&m.id?m:this.get_node(m);var j=a.match(/^move_node|copy_node|create_node$/i)?m:n,i=this.settings.core.check_callback;return"move_node"!==a&&"copy_node"!==a||k&&k.is_multi||n.id!==m.id&&H.inArray(n.id,m.children)!==l&&-1===H.inArray(m.id,n.children_d)?(j&&j.data&&(j=j.data),j&&j.functions&&(j.functions[a]===!1||j.functions[a]===!0)?(j.functions[a]===!1&&(this._data.core.last_error={error:"check",plugin:"core",id:"core_02",reason:"Node data prevents function: "+a,data:JSON.stringify({chk:a,pos:l,obj:n&&n.id?n.id:!1,par:m&&m.id?m.id:!1})}),j.functions[a]):i===!1||H.isFunction(i)&&i.call(this,a,n,m,l,k)===!1||i&&i[a]===!1?(this._data.core.last_error={error:"check",plugin:"core",id:"core_03",reason:"User config for core.check_callback prevents function: "+a,data:JSON.stringify({chk:a,pos:l,obj:n&&n.id?n.id:!1,par:m&&m.id?m.id:!1})},!1):!0):(this._data.core.last_error={error:"check",plugin:"core",id:"core_01",reason:"Moving parent inside child",data:JSON.stringify({chk:a,pos:l,obj:n&&n.id?n.id:!1,par:m&&m.id?m.id:!1})},!1)},last_error:function(){return this._data.core.last_error},move_node:function(aa,Z,Y,X,W,V,U){var T,S,R,Q,P,O,N,M,L,K,J,I,b,a;if(Z=this.get_node(Z),Y=Y===G?0:Y,!Z){return !1}if(!Y.toString().match(/^(before|after)$/)&&!W&&!this.is_loaded(Z)){return this.load_node(Z,function(){this.move_node(aa,Z,Y,X,!0,!1,U)})}if(H.isArray(aa)){if(1!==aa.length){for(T=0,S=aa.length;S>T;T++){(L=this.move_node(aa[T],Z,Y,X,W,!1,U))&&(Z=L,Y="after")}return this.redraw(),!0}aa=aa[0]}if(aa=aa&&aa.id?aa:this.get_node(aa),!aa||aa.id===H.jstree.root){return !1}if(R=(aa.parent||H.jstree.root).toString(),P=Y.toString().match(/^(before|after)$/)&&Z.id!==H.jstree.root?this.get_node(Z.parent):Z,O=U?U:this._model.data[aa.id]?this:H.jstree.reference(aa.id),N=!O||!O._id||this._id!==O._id,Q=O&&O._id&&R&&O._model.data[R]&&O._model.data[R].children?H.inArray(aa.id,O._model.data[R].children):-1,O&&O._id&&(aa=O._model.data[aa.id]),N){return(L=this.copy_node(aa,Z,Y,X,W,!1,U))?(O&&O.delete_node(aa),L):!1}switch(Z.id===H.jstree.root&&("before"===Y&&(Y="first"),"after"===Y&&(Y="last")),Y){case"before":Y=H.inArray(Z.id,P.children);break;case"after":Y=H.inArray(Z.id,P.children)+1;break;case"inside":case"first":Y=0;break;case"last":Y=P.children.length;break;default:Y||(Y=0)}if(Y>P.children.length&&(Y=P.children.length),!this.check("move_node",aa,P,Y,{core:!0,origin:U,is_multi:O&&O._id&&O._id!==this._id,is_foreign:!O||!O._id})){return this.settings.core.error.call(this,this._data.core.last_error),!1}if(aa.parent===P.id){for(M=P.children.concat(),L=H.inArray(aa.id,M),-1!==L&&(M=H.vakata.array_remove(M,L),Y>L&&Y--),L=[],K=0,J=M.length;J>K;K++){L[K>=Y?K+1:K]=M[K]}L[Y]=aa.id,P.children=L,this._node_changed(P.id),this.redraw(P.id===H.jstree.root)}else{for(L=aa.children_d.concat(),L.push(aa.id),K=0,J=aa.parents.length;J>K;K++){for(M=[],a=O._model.data[aa.parents[K]].children_d,I=0,b=a.length;b>I;I++){-1===H.inArray(a[I],L)&&M.push(a[I])}O._model.data[aa.parents[K]].children_d=M}for(O._model.data[R].children=H.vakata.array_remove_item(O._model.data[R].children,aa.id),K=0,J=P.parents.length;J>K;K++){this._model.data[P.parents[K]].children_d=this._model.data[P.parents[K]].children_d.concat(L)}for(M=[],K=0,J=P.children.length;J>K;K++){M[K>=Y?K+1:K]=P.children[K]}for(M[Y]=aa.id,P.children=M,P.children_d.push(aa.id),P.children_d=P.children_d.concat(aa.children_d),aa.parent=P.id,L=P.parents.concat(),L.unshift(P.id),a=aa.parents.length,aa.parents=L,L=L.concat(),K=0,J=aa.children_d.length;J>K;K++){this._model.data[aa.children_d[K]].parents=this._model.data[aa.children_d[K]].parents.slice(0,-1*a),Array.prototype.push.apply(this._model.data[aa.children_d[K]].parents,L)}(R===H.jstree.root||P.id===H.jstree.root)&&(this._model.force_full_redraw=!0),this._model.force_full_redraw||(this._node_changed(R),this._node_changed(P.id)),V||this.redraw()}return X&&X.call(this,aa,P,Y),this.trigger("move_node",{node:aa,parent:P.id,position:Y,old_parent:R,old_position:Q,is_multi:O&&O._id&&O._id!==this._id,is_foreign:!O||!O._id,old_instance:O,new_instance:this}),aa.id},copy_node:function(X,W,V,U,T,S,R){var Q,P,O,N,M,L,K,J,I,b,a;if(W=this.get_node(W),V=V===G?0:V,!W){return !1}if(!V.toString().match(/^(before|after)$/)&&!T&&!this.is_loaded(W)){return this.load_node(W,function(){this.copy_node(X,W,V,U,!0,!1,R)})}if(H.isArray(X)){if(1!==X.length){for(Q=0,P=X.length;P>Q;Q++){(N=this.copy_node(X[Q],W,V,U,T,!0,R))&&(W=N,V="after")}return this.redraw(),!0}X=X[0]}if(X=X&&X.id?X:this.get_node(X),!X||X.id===H.jstree.root){return !1}switch(J=(X.parent||H.jstree.root).toString(),I=V.toString().match(/^(before|after)$/)&&W.id!==H.jstree.root?this.get_node(W.parent):W,b=R?R:this._model.data[X.id]?this:H.jstree.reference(X.id),a=!b||!b._id||this._id!==b._id,b&&b._id&&(X=b._model.data[X.id]),W.id===H.jstree.root&&("before"===V&&(V="first"),"after"===V&&(V="last")),V){case"before":V=H.inArray(W.id,I.children);break;case"after":V=H.inArray(W.id,I.children)+1;break;case"inside":case"first":V=0;break;case"last":V=I.children.length;break;default:V||(V=0)}if(V>I.children.length&&(V=I.children.length),!this.check("copy_node",X,I,V,{core:!0,origin:R,is_multi:b&&b._id&&b._id!==this._id,is_foreign:!b||!b._id})){return this.settings.core.error.call(this,this._data.core.last_error),!1}if(K=b?b.get_json(X,{no_id:!0,no_data:!0,no_state:!0}):X,!K){return !1}if(K.id===!0&&delete K.id,K=this._parse_model_from_json(K,I.id,I.parents.concat()),!K){return !1}for(N=this.get_node(K),X&&X.state&&X.state.loaded===!1&&(N.state.loaded=!1),O=[],O.push(K),O=O.concat(N.children_d),this.trigger("model",{nodes:O,parent:I.id}),M=0,L=I.parents.length;L>M;M++){this._model.data[I.parents[M]].children_d=this._model.data[I.parents[M]].children_d.concat(O)}for(O=[],M=0,L=I.children.length;L>M;M++){O[M>=V?M+1:M]=I.children[M]}return O[V]=N.id,I.children=O,I.children_d.push(N.id),I.children_d=I.children_d.concat(N.children_d),I.id===H.jstree.root&&(this._model.force_full_redraw=!0),this._model.force_full_redraw||this._node_changed(I.id),S||this.redraw(I.id===H.jstree.root),U&&U.call(this,N,I,V),this.trigger("copy_node",{node:N,original:X,parent:I.id,position:V,old_parent:J,old_position:b&&b._id&&J&&b._model.data[J]&&b._model.data[J].children?H.inArray(X.id,b._model.data[J].children):-1,is_multi:b&&b._id&&b._id!==this._id,is_foreign:!b||!b._id,old_instance:b,new_instance:this}),N.id},cut:function(a){if(a||(a=this._data.core.selected.concat()),H.isArray(a)||(a=[a]),!a.length){return !1}var j=[],f,e,d;for(e=0,d=a.length;d>e;e++){f=this.get_node(a[e]),f&&f.id&&f.id!==H.jstree.root&&j.push(f)}return j.length?(E=j,C=this,D="move_node",void this.trigger("cut",{node:a})):!1},copy:function(a){if(a||(a=this._data.core.selected.concat()),H.isArray(a)||(a=[a]),!a.length){return !1}var j=[],f,e,d;for(e=0,d=a.length;d>e;e++){f=this.get_node(a[e]),f&&f.id&&f.id!==H.jstree.root&&j.push(f)}return j.length?(E=j,C=this,D="copy_node",void this.trigger("copy",{node:a})):!1},get_buffer:function(){return{mode:D,node:E,inst:C}},can_paste:function(){return D!==!1&&E!==!1},paste:function(d,c){return d=this.get_node(d),d&&D&&D.match(/^(copy_node|move_node)$/)&&E?(this[D](E,d,c,!1,!1,!1,C)&&this.trigger("paste",{parent:d.id,node:E,mode:D}),E=!1,D=!1,void (C=!1)):!1},clear_buffer:function(){E=!1,D=!1,C=!1,this.trigger("clear_buffer")},edit:function(Q,P,O){var N,M,L,K,J,I,q,p,o,a=!1;return(Q=this.get_node(Q))?this.settings.core.check_callback===!1?(this._data.core.last_error={error:"check",plugin:"core",id:"core_07",reason:"Could not edit node because of check_callback"},this.settings.core.error.call(this,this._data.core.last_error),!1):(o=Q,P="string"==typeof P?P:Q.text,this.set_text(Q,""),Q=this._open_to(Q),o.text=P,N=this._data.core.rtl,M=this.element.width(),this._data.core.focused=o.id,L=Q.children(".jstree-anchor").focus(),K=H("<span>"),J=P,I=H("<div />",{css:{position:"absolute",top:"-200px",left:N?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),q=H("<input />",{value:J,"class":"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:H.proxy(function(i){i.stopImmediatePropagation(),i.preventDefault();var h=K.children(".jstree-rename-input"),g=h.val(),d=this.settings.core.force_text,b;""===g&&(g=J),I.remove(),K.replaceWith(L),K.remove(),J=d?J:H("<div></div>").append(H.parseHTML(J)).html(),this.set_text(Q,J),b=!!this.rename_node(Q,d?H("<div></div>").text(g).text():H("<div></div>").append(H.parseHTML(g)).html()),b||this.set_text(Q,J),this._data.core.focused=o.id,setTimeout(H.proxy(function(){var c=this.get_node(o.id,!0);c.length&&(this._data.core.focused=o.id,c.children(".jstree-anchor").focus())},this),0),O&&O.call(this,o,b,a)},this),keydown:function(d){var c=d.which;27===c&&(a=!0,this.value=J),(27===c||13===c||37===c||38===c||39===c||40===c||32===c)&&d.stopImmediatePropagation(),(27===c||13===c)&&(d.preventDefault(),this.blur())},click:function(b){b.stopImmediatePropagation()},mousedown:function(b){b.stopImmediatePropagation()},keyup:function(b){q.width(Math.min(I.text("pW"+this.value).width(),M))},keypress:function(b){return 13===b.which?!1:void 0}}),p={fontFamily:L.css("fontFamily")||"",fontSize:L.css("fontSize")||"",fontWeight:L.css("fontWeight")||"",fontStyle:L.css("fontStyle")||"",fontStretch:L.css("fontStretch")||"",fontVariant:L.css("fontVariant")||"",letterSpacing:L.css("letterSpacing")||"",wordSpacing:L.css("wordSpacing")||""},K.attr("class",L.attr("class")).append(L.contents().clone()).append(q),L.replaceWith(K),I.css(p),void q.css(p).width(Math.min(I.text("pW"+q[0].value).width(),M))[0].select()):!1},set_theme:function(a,f){if(!a){return !1}if(f===!0){var e=this.settings.core.themes.dir;e||(e=H.jstree.path+"/themes"),f=e+"/"+a+"/style.css"}f&&-1===H.inArray(f,B)&&(H("head").append('<link rel="stylesheet" href="'+f+'" type="text/css" />'),B.push(f)),this._data.core.themes.name&&this.element.removeClass("jstree-"+this._data.core.themes.name),this._data.core.themes.name=a,this.element.addClass("jstree-"+a),this.element[this.settings.core.themes.responsive?"addClass":"removeClass"]("jstree-"+a+"-responsive"),this.trigger("set_theme",{theme:a})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(b){this._data.core.themes.variant&&this.element.removeClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant),this._data.core.themes.variant=b,b&&this.element.addClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=!0,this.get_container_ul().addClass("jstree-striped")},hide_stripes:function(){this._data.core.themes.stripes=!1,this.get_container_ul().removeClass("jstree-striped")},toggle_stripes:function(){this._data.core.themes.stripes?this.hide_stripes():this.show_stripes()},show_dots:function(){this._data.core.themes.dots=!0,this.get_container_ul().removeClass("jstree-no-dots")},hide_dots:function(){this._data.core.themes.dots=!1,this.get_container_ul().addClass("jstree-no-dots")},toggle_dots:function(){this._data.core.themes.dots?this.hide_dots():this.show_dots()},show_icons:function(){this._data.core.themes.icons=!0,this.get_container_ul().removeClass("jstree-no-icons")},hide_icons:function(){this._data.core.themes.icons=!1,this.get_container_ul().addClass("jstree-no-icons")},toggle_icons:function(){this._data.core.themes.icons?this.hide_icons():this.show_icons()},set_icon:function(l,k){var j,i,b,a;if(H.isArray(l)){for(l=l.slice(),j=0,i=l.length;i>j;j++){this.set_icon(l[j],k)}return !0}return l=this.get_node(l),l&&l.id!==H.jstree.root?(a=l.icon,l.icon=k===!0||null===k||k===G||""===k?!0:k,b=this.get_node(l,!0).children(".jstree-anchor").children(".jstree-themeicon"),k===!1?this.hide_icon(l):k===!0||null===k||k===G||""===k?(b.removeClass("jstree-themeicon-custom "+a).css("background","").removeAttr("rel"),a===!1&&this.show_icon(l)):-1===k.indexOf("/")&&-1===k.indexOf(".")?(b.removeClass(a).css("background",""),b.addClass(k+" jstree-themeicon-custom").attr("rel",k),a===!1&&this.show_icon(l)):(b.removeClass(a).css("background",""),b.addClass("jstree-themeicon-custom").css("background","url('"+k+"') center center no-repeat").attr("rel",k),a===!1&&this.show_icon(l)),!0):!1},get_icon:function(a){return a=this.get_node(a),a&&a.id!==H.jstree.root?a.icon:!1},hide_icon:function(a){var f,e;if(H.isArray(a)){for(a=a.slice(),f=0,e=a.length;e>f;f++){this.hide_icon(a[f])}return !0}return a=this.get_node(a),a&&a!==H.jstree.root?(a.icon=!1,this.get_node(a,!0).children(".jstree-anchor").children(".jstree-themeicon").addClass("jstree-themeicon-hidden"),!0):!1},show_icon:function(a){var h,g,f;if(H.isArray(a)){for(a=a.slice(),h=0,g=a.length;g>h;h++){this.show_icon(a[h])}return !0}return a=this.get_node(a),a&&a!==H.jstree.root?(f=this.get_node(a,!0),a.icon=f.length?f.children(".jstree-anchor").children(".jstree-themeicon").attr("rel"):!0,a.icon||(a.icon=!0),f.children(".jstree-anchor").children(".jstree-themeicon").removeClass("jstree-themeicon-hidden"),!0):!1}},H.vakata={},H.vakata.attributes=function(a,f){a=H(a)[0];var e=f?{}:[];return a&&a.attributes&&H.each(a.attributes,function(c,d){-1===H.inArray(d.name.toLowerCase(),["style","contenteditable","hasfocus","tabindex"])&&null!==d.value&&""!==H.trim(d.value)&&(f?e[d.name]=d.value:e.push(d.name))}),e},H.vakata.array_unique=function(b){var l=[],k,j,i,h={};for(k=0,i=b.length;i>k;k++){h[b[k]]===G&&(l.push(b[k]),h[b[k]]=!0)}return l},H.vakata.array_remove=function(f,e,h){var g=f.slice((h||e)+1||f.length);return f.length=0>e?f.length+e:e,f.push.apply(f,g),f},H.vakata.array_remove_item=function(a,f){var e=H.inArray(f,a);return -1!==e?H.vakata.array_remove(a,e):a},H.jstree.plugins.changed=function(e,d){var f=[];this.trigger=function(b,j){var i,h;if(j||(j={}),"changed"===b.replace(".jstree","")){j.changed={selected:[],deselected:[]};var c={};for(i=0,h=f.length;h>i;i++){c[f[i]]=1}for(i=0,h=j.selected.length;h>i;i++){c[j.selected[i]]?c[j.selected[i]]=2:j.changed.selected.push(j.selected[i])}for(i=0,h=f.length;h>i;i++){1===c[f[i]]&&j.changed.deselected.push(f[i])}f=j.selected.slice()}d.trigger.call(this,b,j)},this.refresh=function(b,c){return f=[],d.refresh.apply(this,arguments)}};var v=z.createElement("I");v.className="jstree-icon jstree-checkbox",v.setAttribute("role","presentation"),H.jstree.defaults.checkbox={visible:!0,three_state:!0,whole_node:!0,keep_selected_style:!0,cascade:"",tie_selection:!0},H.jstree.plugins.checkbox=function(b,a){this.bind=function(){a.bind.call(this),this._data.checkbox.uto=!1,this._data.checkbox.selected=[],this.settings.checkbox.three_state&&(this.settings.checkbox.cascade="up+down+undetermined"),this.element.on("init.jstree",H.proxy(function(){this._data.checkbox.visible=this.settings.checkbox.visible,this.settings.checkbox.keep_selected_style||this.element.addClass("jstree-checkbox-no-clicked"),this.settings.checkbox.tie_selection&&this.element.addClass("jstree-checkbox-selection")},this)).on("loading.jstree",H.proxy(function(){this[this._data.checkbox.visible?"show_checkboxes":"hide_checkboxes"]()},this)),-1!==this.settings.checkbox.cascade.indexOf("undetermined")&&this.element.on("changed.jstree uncheck_node.jstree check_node.jstree uncheck_all.jstree check_all.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree",H.proxy(function(){this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(H.proxy(this._undetermined,this),50)},this)),this.settings.checkbox.tie_selection||this.element.on("model.jstree",H.proxy(function(i,h){var n=this._model.data,m=n[h.parent],l=h.nodes,k,j;for(k=0,j=l.length;j>k;k++){n[l[k]].state.checked=n[l[k]].state.checked||n[l[k]].original&&n[l[k]].original.state&&n[l[k]].original.state.checked,n[l[k]].state.checked&&this._data.checkbox.selected.push(l[k])}},this)),(-1!==this.settings.checkbox.cascade.indexOf("up")||-1!==this.settings.checkbox.cascade.indexOf("down"))&&this.element.on("model.jstree",H.proxy(function(T,S){var R=this._model.data,Q=R[S.parent],P=S.nodes,O=[],N,M,L,K,J,I,q=this.settings.checkbox.cascade,p=this.settings.checkbox.tie_selection;if(-1!==q.indexOf("down")){if(Q.state[p?"selected":"checked"]){for(M=0,L=P.length;L>M;M++){R[P[M]].state[p?"selected":"checked"]=!0}this._data[p?"core":"checkbox"].selected=this._data[p?"core":"checkbox"].selected.concat(P)}else{for(M=0,L=P.length;L>M;M++){if(R[P[M]].state[p?"selected":"checked"]){for(K=0,J=R[P[M]].children_d.length;J>K;K++){R[R[P[M]].children_d[K]].state[p?"selected":"checked"]=!0}this._data[p?"core":"checkbox"].selected=this._data[p?"core":"checkbox"].selected.concat(R[P[M]].children_d)}}}}if(-1!==q.indexOf("up")){for(M=0,L=Q.children_d.length;L>M;M++){R[Q.children_d[M]].children.length||O.push(R[Q.children_d[M]].parent)}for(O=H.vakata.array_unique(O),K=0,J=O.length;J>K;K++){Q=R[O[K]];while(Q&&Q.id!==H.jstree.root){for(N=0,M=0,L=Q.children.length;L>M;M++){N+=R[Q.children[M]].state[p?"selected":"checked"]}if(N!==L){break}Q.state[p?"selected":"checked"]=!0,this._data[p?"core":"checkbox"].selected.push(Q.id),I=this.get_node(Q,!0),I&&I.length&&I.attr("aria-selected",!0).children(".jstree-anchor").addClass(p?"jstree-clicked":"jstree-checked"),Q=this.get_node(Q.parent)}}}this._data[p?"core":"checkbox"].selected=H.vakata.array_unique(this._data[p?"core":"checkbox"].selected)},this)).on(this.settings.checkbox.tie_selection?"select_node.jstree":"check_node.jstree",H.proxy(function(P,O){var N=O.node,M=this._model.data,L=this.get_node(N.parent),K=this.get_node(N,!0),J,I,q,p,o=this.settings.checkbox.cascade,n=this.settings.checkbox.tie_selection;if(-1!==o.indexOf("down")){for(this._data[n?"core":"checkbox"].selected=H.vakata.array_unique(this._data[n?"core":"checkbox"].selected.concat(N.children_d)),J=0,I=N.children_d.length;I>J;J++){p=M[N.children_d[J]],p.state[n?"selected":"checked"]=!0,p&&p.original&&p.original.state&&p.original.state.undetermined&&(p.original.state.undetermined=!1)}}if(-1!==o.indexOf("up")){while(L&&L.id!==H.jstree.root){for(q=0,J=0,I=L.children.length;I>J;J++){q+=M[L.children[J]].state[n?"selected":"checked"]}if(q!==I){break}L.state[n?"selected":"checked"]=!0,this._data[n?"core":"checkbox"].selected.push(L.id),p=this.get_node(L,!0),p&&p.length&&p.attr("aria-selected",!0).children(".jstree-anchor").addClass(n?"jstree-clicked":"jstree-checked"),L=this.get_node(L.parent)}}-1!==o.indexOf("down")&&K.length&&K.find(".jstree-anchor").addClass(n?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",!0)},this)).on(this.settings.checkbox.tie_selection?"deselect_all.jstree":"uncheck_all.jstree",H.proxy(function(i,o){var n=this.get_node(H.jstree.root),m=this._model.data,l,k,j;for(l=0,k=n.children_d.length;k>l;l++){j=m[n.children_d[l]],j&&j.original&&j.original.state&&j.original.state.undetermined&&(j.original.state.undetermined=!1)}},this)).on(this.settings.checkbox.tie_selection?"deselect_node.jstree":"uncheck_node.jstree",H.proxy(function(J,I){var q=I.node,p=this.get_node(q,!0),o,n,m,l=this.settings.checkbox.cascade,k=this.settings.checkbox.tie_selection;if(q&&q.original&&q.original.state&&q.original.state.undetermined&&(q.original.state.undetermined=!1),-1!==l.indexOf("down")){for(o=0,n=q.children_d.length;n>o;o++){m=this._model.data[q.children_d[o]],m.state[k?"selected":"checked"]=!1,m&&m.original&&m.original.state&&m.original.state.undetermined&&(m.original.state.undetermined=!1)}}if(-1!==l.indexOf("up")){for(o=0,n=q.parents.length;n>o;o++){m=this._model.data[q.parents[o]],m.state[k?"selected":"checked"]=!1,m&&m.original&&m.original.state&&m.original.state.undetermined&&(m.original.state.undetermined=!1),m=this.get_node(q.parents[o],!0),m&&m.length&&m.attr("aria-selected",!1).children(".jstree-anchor").removeClass(k?"jstree-clicked":"jstree-checked")}}for(m=[],o=0,n=this._data[k?"core":"checkbox"].selected.length;n>o;o++){-1!==l.indexOf("down")&&-1!==H.inArray(this._data[k?"core":"checkbox"].selected[o],q.children_d)||-1!==l.indexOf("up")&&-1!==H.inArray(this._data[k?"core":"checkbox"].selected[o],q.parents)||m.push(this._data[k?"core":"checkbox"].selected[o])}this._data[k?"core":"checkbox"].selected=H.vakata.array_unique(m),-1!==l.indexOf("down")&&p.length&&p.find(".jstree-anchor").removeClass(k?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",!1)},this)),-1!==this.settings.checkbox.cascade.indexOf("up")&&this.element.on("delete_node.jstree",H.proxy(function(J,I){var q=this.get_node(I.parent),p=this._model.data,o,n,m,l,k=this.settings.checkbox.tie_selection;while(q&&q.id!==H.jstree.root&&!q.state[k?"selected":"checked"]){for(m=0,o=0,n=q.children.length;n>o;o++){m+=p[q.children[o]].state[k?"selected":"checked"]}if(!(n>0&&m===n)){break}q.state[k?"selected":"checked"]=!0,this._data[k?"core":"checkbox"].selected.push(q.id),l=this.get_node(q,!0),l&&l.length&&l.attr("aria-selected",!0).children(".jstree-anchor").addClass(k?"jstree-clicked":"jstree-checked"),q=this.get_node(q.parent)}},this)).on("move_node.jstree",H.proxy(function(P,O){var N=O.is_multi,M=O.old_parent,L=this.get_node(O.parent),K=this._model.data,J,I,q,p,o,n=this.settings.checkbox.tie_selection;if(!N){J=this.get_node(M);while(J&&J.id!==H.jstree.root&&!J.state[n?"selected":"checked"]){for(I=0,q=0,p=J.children.length;p>q;q++){I+=K[J.children[q]].state[n?"selected":"checked"]}if(!(p>0&&I===p)){break}J.state[n?"selected":"checked"]=!0,this._data[n?"core":"checkbox"].selected.push(J.id),o=this.get_node(J,!0),o&&o.length&&o.attr("aria-selected",!0).children(".jstree-anchor").addClass(n?"jstree-clicked":"jstree-checked"),J=this.get_node(J.parent)}}J=L;while(J&&J.id!==H.jstree.root){for(I=0,q=0,p=J.children.length;p>q;q++){I+=K[J.children[q]].state[n?"selected":"checked"]}if(I===p){J.state[n?"selected":"checked"]||(J.state[n?"selected":"checked"]=!0,this._data[n?"core":"checkbox"].selected.push(J.id),o=this.get_node(J,!0),o&&o.length&&o.attr("aria-selected",!0).children(".jstree-anchor").addClass(n?"jstree-clicked":"jstree-checked"))}else{if(!J.state[n?"selected":"checked"]){break}J.state[n?"selected":"checked"]=!1,this._data[n?"core":"checkbox"].selected=H.vakata.array_remove_item(this._data[n?"core":"checkbox"].selected,J.id),o=this.get_node(J,!0),o&&o.length&&o.attr("aria-selected",!1).children(".jstree-anchor").removeClass(n?"jstree-clicked":"jstree-checked")}J=this.get_node(J.parent)}},this))},this._undetermined=function(){if(null!==this.element){var M,L,K,J,I={},q=this._model.data,p=this.settings.checkbox.tie_selection,o=this._data[p?"core":"checkbox"].selected,n=[],m=this;for(M=0,L=o.length;L>M;M++){if(q[o[M]]&&q[o[M]].parents){for(K=0,J=q[o[M]].parents.length;J>K;K++){I[q[o[M]].parents[K]]===G&&q[o[M]].parents[K]!==H.jstree.root&&(I[q[o[M]].parents[K]]=!0,n.push(q[o[M]].parents[K]))}}}for(this.element.find(".jstree-closed").not(":has(.jstree-children)").each(function(){var d=m.get_node(this),c;if(d.state.loaded){for(M=0,L=d.children_d.length;L>M;M++){if(c=q[d.children_d[M]],!c.state.loaded&&c.original&&c.original.state&&c.original.state.undetermined&&c.original.state.undetermined===!0){for(I[c.id]===G&&c.id!==H.jstree.root&&(I[c.id]=!0,n.push(c.id)),K=0,J=c.parents.length;J>K;K++){I[c.parents[K]]===G&&c.parents[K]!==H.jstree.root&&(I[c.parents[K]]=!0,n.push(c.parents[K]))}}}}else{if(d.original&&d.original.state&&d.original.state.undetermined&&d.original.state.undetermined===!0){for(I[d.id]===G&&d.id!==H.jstree.root&&(I[d.id]=!0,n.push(d.id)),K=0,J=d.parents.length;J>K;K++){I[d.parents[K]]===G&&d.parents[K]!==H.jstree.root&&(I[d.parents[K]]=!0,n.push(d.parents[K]))}}}}),this.element.find(".jstree-undetermined").removeClass("jstree-undetermined"),M=0,L=n.length;L>M;M++){q[n[M]].state[p?"selected":"checked"]||(o=this.get_node(n[M],!0),o&&o.length&&o.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-undetermined"))}}},this.redraw_node=function(d,q,p,o){if(d=a.redraw_node.apply(this,arguments)){var n,m,l=null,k=null;for(n=0,m=d.childNodes.length;m>n;n++){if(d.childNodes[n]&&d.childNodes[n].className&&-1!==d.childNodes[n].className.indexOf("jstree-anchor")){l=d.childNodes[n];break}}l&&(!this.settings.checkbox.tie_selection&&this._model.data[d.id].state.checked&&(l.className+=" jstree-checked"),k=v.cloneNode(!1),this._model.data[d.id].state.checkbox_disabled&&(k.className+=" jstree-checkbox-disabled"),l.insertBefore(k,l.childNodes[0]))}return p||-1===this.settings.checkbox.cascade.indexOf("undetermined")||(this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(H.proxy(this._undetermined,this),50)),d},this.show_checkboxes=function(){this._data.core.themes.checkboxes=!0,this.get_container_ul().removeClass("jstree-no-checkboxes")},this.hide_checkboxes=function(){this._data.core.themes.checkboxes=!1,this.get_container_ul().addClass("jstree-no-checkboxes")},this.toggle_checkboxes=function(){this._data.core.themes.checkboxes?this.hide_checkboxes():this.show_checkboxes()},this.is_undetermined=function(i){i=this.get_node(i);var o=this.settings.checkbox.cascade,n,m,l=this.settings.checkbox.tie_selection,k=this._data[l?"core":"checkbox"].selected,j=this._model.data;if(!i||i.state[l?"selected":"checked"]===!0||-1===o.indexOf("undetermined")||-1===o.indexOf("down")&&-1===o.indexOf("up")){return !1}if(!i.state.loaded&&i.original.state.undetermined===!0){return !0}for(n=0,m=i.children_d.length;m>n;n++){if(-1!==H.inArray(i.children_d[n],k)||!j[i.children_d[n]].state.loaded&&j[i.children_d[n]].original.state.undetermined){return !0}}return !1},this.disable_checkbox=function(f){var i,h,g;if(H.isArray(f)){for(f=f.slice(),i=0,h=f.length;h>i;i++){this.disable_checkbox(f[i])}return !0}return f=this.get_node(f),f&&f.id!==H.jstree.root?(g=this.get_node(f,!0),void (f.state.checkbox_disabled||(f.state.checkbox_disabled=!0,g&&g.length&&g.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-checkbox-disabled"),this.trigger("disable_checkbox",{node:f})))):!1},this.enable_checkbox=function(f){var i,h,g;if(H.isArray(f)){for(f=f.slice(),i=0,h=f.length;h>i;i++){this.enable_checkbox(f[i])}return !0}return f=this.get_node(f),f&&f.id!==H.jstree.root?(g=this.get_node(f,!0),void (f.state.checkbox_disabled&&(f.state.checkbox_disabled=!1,g&&g.length&&g.children(".jstree-anchor").children(".jstree-checkbox").removeClass("jstree-checkbox-disabled"),this.trigger("enable_checkbox",{node:f})))):!1},this.activate_node=function(d,e){return H(e.target).hasClass("jstree-checkbox-disabled")?!1:(this.settings.checkbox.tie_selection&&(this.settings.checkbox.whole_node||H(e.target).hasClass("jstree-checkbox"))&&(e.ctrlKey=!0),this.settings.checkbox.tie_selection||!this.settings.checkbox.whole_node&&!H(e.target).hasClass("jstree-checkbox")?a.activate_node.call(this,d,e):this.is_disabled(d)?!1:(this.is_checked(d)?this.uncheck_node(d,e):this.check_node(d,e),void this.trigger("activate_node",{node:this.get_node(d)})))},this.check_node=function(h,m){if(this.settings.checkbox.tie_selection){return this.select_node(h,!1,!0,m)}var l,k,j,i;if(H.isArray(h)){for(h=h.slice(),k=0,j=h.length;j>k;k++){this.check_node(h[k],m)}return !0}return h=this.get_node(h),h&&h.id!==H.jstree.root?(l=this.get_node(h,!0),void (h.state.checked||(h.state.checked=!0,this._data.checkbox.selected.push(h.id),l&&l.length&&l.children(".jstree-anchor").addClass("jstree-checked"),this.trigger("check_node",{node:h,selected:this._data.checkbox.selected,event:m})))):!1},this.uncheck_node=function(g,k){if(this.settings.checkbox.tie_selection){return this.deselect_node(g,!1,k)}var j,i,h;if(H.isArray(g)){for(g=g.slice(),j=0,i=g.length;i>j;j++){this.uncheck_node(g[j],k)}return !0}return g=this.get_node(g),g&&g.id!==H.jstree.root?(h=this.get_node(g,!0),void (g.state.checked&&(g.state.checked=!1,this._data.checkbox.selected=H.vakata.array_remove_item(this._data.checkbox.selected,g.id),h.length&&h.children(".jstree-anchor").removeClass("jstree-checked"),this.trigger("uncheck_node",{node:g,selected:this._data.checkbox.selected,event:k})))):!1},this.check_all=function(){if(this.settings.checkbox.tie_selection){return this.select_all()}var e=this._data.checkbox.selected.concat([]),g,f;for(this._data.checkbox.selected=this._model.data[H.jstree.root].children_d.concat(),g=0,f=this._data.checkbox.selected.length;f>g;g++){this._model.data[this._data.checkbox.selected[g]]&&(this._model.data[this._data.checkbox.selected[g]].state.checked=!0)}this.redraw(!0),this.trigger("check_all",{selected:this._data.checkbox.selected})},this.uncheck_all=function(){if(this.settings.checkbox.tie_selection){return this.deselect_all()}var e=this._data.checkbox.selected.concat([]),d,f;for(d=0,f=this._data.checkbox.selected.length;f>d;d++){this._model.data[this._data.checkbox.selected[d]]&&(this._model.data[this._data.checkbox.selected[d]].state.checked=!1)}this._data.checkbox.selected=[],this.element.find(".jstree-checked").removeClass("jstree-checked"),this.trigger("uncheck_all",{selected:this._data.checkbox.selected,node:e})},this.is_checked=function(c){return this.settings.checkbox.tie_selection?this.is_selected(c):(c=this.get_node(c),c&&c.id!==H.jstree.root?c.state.checked:!1)},this.get_checked=function(c){return this.settings.checkbox.tie_selection?this.get_selected(c):c?H.map(this._data.checkbox.selected,H.proxy(function(d){return this.get_node(d)},this)):this._data.checkbox.selected},this.get_top_checked=function(i){if(this.settings.checkbox.tie_selection){return this.get_top_selected(i)}var o=this.get_checked(!0),n={},m,l,k,j;for(m=0,l=o.length;l>m;m++){n[o[m].id]=o[m]}for(m=0,l=o.length;l>m;m++){for(k=0,j=o[m].children_d.length;j>k;k++){n[o[m].children_d[k]]&&delete n[o[m].children_d[k]]}}o=[];for(m in n){n.hasOwnProperty(m)&&o.push(m)}return i?H.map(o,H.proxy(function(c){return this.get_node(c)},this)):o},this.get_bottom_checked=function(g){if(this.settings.checkbox.tie_selection){return this.get_bottom_selected(g)}var k=this.get_checked(!0),j=[],i,h;for(i=0,h=k.length;h>i;i++){k[i].children.length||j.push(k[i].id)}return g?H.map(j,H.proxy(function(c){return this.get_node(c)},this)):j},this.load_node=function(d,q){var p,o,n,m,l,k;if(!H.isArray(d)&&!this.settings.checkbox.tie_selection&&(k=this.get_node(d),k&&k.state.loaded)){for(p=0,o=k.children_d.length;o>p;p++){this._model.data[k.children_d[p]].state.checked&&(l=!0,this._data.checkbox.selected=H.vakata.array_remove_item(this._data.checkbox.selected,k.children_d[p]))}}return a.load_node.apply(this,arguments)},this.get_state=function(){var c=a.get_state.apply(this,arguments);return this.settings.checkbox.tie_selection?c:(c.checkbox=this._data.checkbox.selected.slice(),c)},this.set_state=function(d,i){var h=a.set_state.apply(this,arguments);if(h&&d.checkbox){if(!this.settings.checkbox.tie_selection){this.uncheck_all();var g=this;H.each(d.checkbox,function(e,c){g.check_node(c)})}return delete d.checkbox,this.set_state(d,i),!1}return h},this.refresh=function(d,c){return this.settings.checkbox.tie_selection||(this._data.checkbox.selected=[]),a.refresh.apply(this,arguments)}},H.jstree.defaults.conditionalselect=function(){return !0},H.jstree.plugins.conditionalselect=function(d,c){this.activate_node=function(b,e){this.settings.conditionalselect.call(this,this.get_node(b),e)&&c.activate_node.call(this,b,e)}},H.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(a,d){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"Create",action:function(e){var g=H.jstree.reference(e.reference),f=g.get_node(e.reference);g.create_node(f,{},"last",function(b){setTimeout(function(){g.edit(b)},0)})}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:"Rename",action:function(e){var g=H.jstree.reference(e.reference),f=g.get_node(e.reference);g.edit(f)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete",action:function(e){var g=H.jstree.reference(e.reference),f=g.get_node(e.reference);g.is_selected(f)?g.delete_node(g.get_selected()):g.delete_node(f)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:"Cut",action:function(e){var g=H.jstree.reference(e.reference),f=g.get_node(e.reference);g.is_selected(f)?g.cut(g.get_top_selected()):g.cut(f)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(e){var g=H.jstree.reference(e.reference),f=g.get_node(e.reference);g.is_selected(f)?g.copy(g.get_top_selected()):g.copy(f)}},paste:{separator_before:!1,icon:!1,_disabled:function(c){return !H.jstree.reference(c.reference).can_paste()},separator_after:!1,label:"Paste",action:function(e){var g=H.jstree.reference(e.reference),f=g.get_node(e.reference);g.paste(f)}}}}}}},H.jstree.plugins.contextmenu=function(b,a){this.bind=function(){a.bind.call(this);var d=0,i=null,h,g;this.element.on("contextmenu.jstree",".jstree-anchor",H.proxy(function(c,e){c.preventDefault(),d=c.ctrlKey?+new Date:0,(e||i)&&(d=+new Date+10000),i&&clearTimeout(i),this.is_loading(c.currentTarget)||this.show_contextmenu(c.currentTarget,c.pageX,c.pageY,c)},this)).on("click.jstree",".jstree-anchor",H.proxy(function(e){this._data.contextmenu.visible&&(!d||+new Date-d>250)&&H.vakata.context.hide(),d=0},this)).on("touchstart.jstree",".jstree-anchor",function(c){c.originalEvent&&c.originalEvent.changedTouches&&c.originalEvent.changedTouches[0]&&(h=c.pageX,g=c.pageY,i=setTimeout(function(){H(c.currentTarget).trigger("contextmenu",!0)},750))}).on("touchmove.vakata.jstree",function(c){i&&c.originalEvent&&c.originalEvent.changedTouches&&c.originalEvent.changedTouches[0]&&(Math.abs(h-c.pageX)>50||Math.abs(g-c.pageY)>50)&&clearTimeout(i)}).on("touchend.vakata.jstree",function(c){i&&clearTimeout(i)}),H(z).on("context_hide.vakata.jstree",H.proxy(function(){this._data.contextmenu.visible=!1},this))},this.teardown=function(){this._data.contextmenu.visible&&H.vakata.context.hide(),a.teardown.call(this)},this.show_contextmenu=function(K,J,I,q){if(K=this.get_node(K),!K||K.id===H.jstree.root){return !1}var p=this.settings.contextmenu,o=this.get_node(K,!0),n=o.children(".jstree-anchor"),m=!1,l=!1;(p.show_at_node||J===G||I===G)&&(m=n.offset(),J=m.left,I=m.top+this._data.core.li_height),this.settings.contextmenu.select_node&&!this.is_selected(K)&&this.activate_node(K,q),l=p.items,H.isFunction(l)&&(l=l.call(this,K,H.proxy(function(c){this._show_contextmenu(K,J,I,c)},this))),H.isPlainObject(l)&&this._show_contextmenu(K,J,I,l)},this._show_contextmenu=function(h,m,l,k){var j=this.get_node(h,!0),i=j.children(".jstree-anchor");H(z).one("context_show.vakata.jstree",H.proxy(function(e,g){var f="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";H(g.element).addClass(f)},this)),this._data.contextmenu.visible=!0,H.vakata.context.show(i,{x:m,y:l},k),this.trigger("show_contextmenu",{node:h,x:m,y:l})}},function(e){var d=!1,f={element:!1,reference:!1,position_x:0,position_y:0,items:[],html:"",is_visible:!1};e.vakata.context={settings:{hide_onmouseleave:0,icons:!0},_trigger:function(a){e(z).triggerHandler("context_"+a+".vakata",{reference:f.reference,element:f.element,position:{x:f.position_x,y:f.position_y}})},_execute:function(a){return a=f.items[a],a&&(!a._disabled||e.isFunction(a._disabled)&&!a._disabled({item:a,reference:f.reference,element:f.element}))&&a.action?a.action.call(null,{item:a,reference:f.reference,element:f.element,position:{x:f.position_x,y:f.position_y}}):!1},_parse:function(a,j){if(!a){return !1}j||(f.html="",f.items=[]);var i="",h=!1,c;return j&&(i+="<ul>"),e.each(a,function(g,k){return k?(f.items.push(k),!h&&k.separator_before&&(i+="<li class='vakata-context-separator'><a href='#' "+(e.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>"),h=!1,i+="<li class='"+(k._class||"")+(k._disabled===!0||e.isFunction(k._disabled)&&k._disabled({item:k,reference:f.reference,element:f.element})?" vakata-contextmenu-disabled ":"")+"' "+(k.shortcut?" data-shortcut='"+k.shortcut+"' ":"")+">",i+="<a href='#' rel='"+(f.items.length-1)+"'>",e.vakata.context.settings.icons&&(i+="<i ",k.icon&&(i+=-1!==k.icon.indexOf("/")||-1!==k.icon.indexOf(".")?" style='background:url(\""+k.icon+"\") center center no-repeat' ":" class='"+k.icon+"' "),i+="></i><span class='vakata-contextmenu-sep'>&#160;</span>"),i+=(e.isFunction(k.label)?k.label({item:g,reference:f.reference,element:f.element}):k.label)+(k.shortcut?' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+k.shortcut+'">'+(k.shortcut_label||"")+"</span>":"")+"</a>",k.submenu&&(c=e.vakata.context._parse(k.submenu,!0),c&&(i+=c)),i+="</li>",void (k.separator_after&&(i+="<li class='vakata-context-separator'><a href='#' "+(e.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>",h=!0))):!0}),i=i.replace(/<li class\='vakata-context-separator'\><\/li\>$/,""),j&&(i+="</ul>"),j||(f.html=i,e.vakata.context._trigger("parse")),i.length>10?i:!1},_show_submenu:function(p){if(p=e(p),p.length&&p.children("ul").length){var o=p.children("ul"),n=p.offset().left+p.outerWidth(),m=p.offset().top,l=o.width(),k=o.height(),b=e(window).width()+e(window).scrollLeft(),a=e(window).height()+e(window).scrollTop();d?p[n-(l+10+p.outerWidth())<0?"addClass":"removeClass"]("vakata-context-left"):p[n+l+10>b?"addClass":"removeClass"]("vakata-context-right"),m+k+10>a&&o.css("bottom","-1px"),o.show()}},show:function(O,N,M){var L,K,J,I,q,p,c,b,a=!0;switch(f.element&&f.element.length&&f.element.width(""),a){case !N&&!O:return !1;case !!N&&!!O:f.reference=O,f.position_x=N.x,f.position_y=N.y;break;case !N&&!!O:f.reference=O,L=O.offset(),f.position_x=L.left+O.outerHeight(),f.position_y=L.top;break;case !!N&&!O:f.position_x=N.x,f.position_y=N.y}O&&!M&&e(O).data("vakata_contextmenu")&&(M=e(O).data("vakata_contextmenu")),e.vakata.context._parse(M)&&f.element.html(f.html),f.items.length&&(f.element.appendTo("body"),K=f.element,J=f.position_x,I=f.position_y,q=K.width(),p=K.height(),c=e(window).width()+e(window).scrollLeft(),b=e(window).height()+e(window).scrollTop(),d&&(J-=K.outerWidth()-e(O).outerWidth(),J<e(window).scrollLeft()+20&&(J=e(window).scrollLeft()+20)),J+q+20>c&&(J=c-(q+20)),I+p+20>b&&(I=b-(p+20)),f.element.css({left:J,top:I}).show().find("a").first().focus().parent().addClass("vakata-context-hover"),f.is_visible=!0,e.vakata.context._trigger("show"))},hide:function(){f.is_visible&&(f.element.hide().find("ul").hide().end().find(":focus").blur().end().detach(),f.is_visible=!1,e.vakata.context._trigger("hide"))}},e(function(){d="rtl"===e("body").css("direction");var a=!1;f.element=e("<ul class='vakata-context'></ul>"),f.element.on("mouseenter","li",function(c){c.stopImmediatePropagation(),e.contains(this,c.relatedTarget)||(a&&clearTimeout(a),f.element.find(".vakata-context-hover").removeClass("vakata-context-hover").end(),e(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover"),e.vakata.context._show_submenu(this))}).on("mouseleave","li",function(c){e.contains(this,c.relatedTarget)||e(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")}).on("mouseleave",function(c){e(this).find(".vakata-context-hover").removeClass("vakata-context-hover"),e.vakata.context.settings.hide_onmouseleave&&(a=setTimeout(function(g){return function(){e.vakata.context.hide()}}(this),e.vakata.context.settings.hide_onmouseleave))}).on("click","a",function(c){c.preventDefault(),e(this).blur().parent().hasClass("vakata-context-disabled")||e.vakata.context._execute(e(this).attr("rel"))===!1||e.vakata.context.hide()}).on("keydown","a",function(c){var g=null;switch(c.which){case 13:case 32:c.type="mouseup",c.preventDefault(),e(c.currentTarget).trigger(c);break;case 37:f.is_visible&&(f.element.find(".vakata-context-hover").last().closest("li").first().find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").focus(),c.stopImmediatePropagation(),c.preventDefault());break;case 38:f.is_visible&&(g=f.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first(),g.length||(g=f.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last()),g.addClass("vakata-context-hover").children("a").focus(),c.stopImmediatePropagation(),c.preventDefault());break;case 39:f.is_visible&&(f.element.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").focus(),c.stopImmediatePropagation(),c.preventDefault());break;case 40:f.is_visible&&(g=f.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first(),g.length||(g=f.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()),g.addClass("vakata-context-hover").children("a").focus(),c.stopImmediatePropagation(),c.preventDefault());break;case 27:e.vakata.context.hide(),c.preventDefault()}}).on("keydown",function(g){g.preventDefault();var c=f.element.find(".vakata-contextmenu-shortcut-"+g.which).parent();c.parent().not(".vakata-context-disabled")&&c.click()}),e(z).on("mousedown.vakata.jstree",function(c){f.is_visible&&!e.contains(f.element[0],c.target)&&e.vakata.context.hide()}).on("context_show.vakata.jstree",function(b,c){f.element.find("li:has(ul)").children("a").addClass("vakata-context-parent"),d&&f.element.addClass("vakata-context-rtl").css("direction","rtl"),f.element.find("ul").hide().end()})})}(H),H.jstree.defaults.dnd={copy:!0,open_timeout:500,is_draggable:!0,check_while_dragging:!0,always_copy:!1,inside_pos:0,drag_selection:!0,touch:!0,large_drop_target:!1,large_drag_target:!1},H.jstree.plugins.dnd=function(a,d){this.bind=function(){d.bind.call(this),this.element.on("mousedown.jstree touchstart.jstree",this.settings.dnd.large_drag_target?".jstree-node":".jstree-anchor",H.proxy(function(f){if(this.settings.dnd.large_drag_target&&H(f.target).closest(".jstree-node")[0]!==f.currentTarget){return !0}if("touchstart"===f.type&&(!this.settings.dnd.touch||"selected"===this.settings.dnd.touch&&!H(f.currentTarget).closest(".jstree-node").children(".jstree-anchor").hasClass("jstree-clicked"))){return !0}var i=this.get_node(f.target),h=this.is_selected(i)&&this.settings.dnd.drag_selection?this.get_top_selected().length:1,g=h>1?h+" "+this.get_string("nodes"):this.get_text(f.currentTarget);return this.settings.core.force_text&&(g=H.vakata.html.escape(g)),i&&i.id&&i.id!==H.jstree.root&&(1===f.which||"touchstart"===f.type)&&(this.settings.dnd.is_draggable===!0||H.isFunction(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,h>1?this.get_top_selected(!0):[i],f))?(this.element.trigger("mousedown.jstree"),H.vakata.dnd.start(f,{jstree:!0,origin:this,obj:this.get_node(i,!0),nodes:h>1?this.get_top_selected():[i.id]},'<div id="jstree-dnd" class="jstree-'+this.get_theme()+" jstree-"+this.get_theme()+"-"+this.get_theme_variant()+" "+(this.settings.core.themes.responsive?" jstree-dnd-responsive":"")+'"><i class="jstree-icon jstree-er"></i>'+g+'<ins class="jstree-copy" style="display:none;">+</ins></div>')):void 0},this))}},H(function(){var a=!1,j=!1,i=!1,h=!1,g=H('<div id="jstree-marker">&#160;</div>').hide();H(z).on("dnd_start.vakata.jstree",function(b,d){a=!1,i=!1,d&&d.data&&d.data.jstree&&g.appendTo("body")}).on("dnd_move.vakata.jstree",function(X,W){if(h&&clearTimeout(h),W&&W.data&&W.data.jstree&&(!W.event.target.id||"jstree-marker"!==W.event.target.id)){i=W.event;var V=H.jstree.reference(W.event.target),U=!1,T=!1,S=!1,R,Q,P,O,M,L,K,J,I,f,e,d,c,b,N;if(V&&V._data&&V._data.dnd){if(g.attr("class","jstree-"+V.get_theme()+(V.settings.core.themes.responsive?" jstree-dnd-responsive":"")),W.helper.children().attr("class","jstree-"+V.get_theme()+" jstree-"+V.get_theme()+"-"+V.get_theme_variant()+" "+(V.settings.core.themes.responsive?" jstree-dnd-responsive":"")).find(".jstree-copy").first()[W.data.origin&&(W.data.origin.settings.dnd.always_copy||W.data.origin.settings.dnd.copy&&(W.event.metaKey||W.event.ctrlKey))?"show":"hide"](),W.event.target!==V.element[0]&&W.event.target!==V.get_container_ul()[0]||0!==V.get_container_ul().children().length){if(U=V.settings.dnd.large_drop_target?H(W.event.target).closest(".jstree-node").children(".jstree-anchor"):H(W.event.target).closest(".jstree-anchor"),U&&U.length&&U.parent().is(".jstree-closed, .jstree-open, .jstree-leaf")&&(T=U.offset(),S=W.event.pageY-T.top,O=U.outerHeight(),K=O/3>S?["b","i","a"]:S>O-O/3?["a","i","b"]:S>O/2?["i","a","b"]:["i","b","a"],H.each(K,function(l,k){switch(k){case"b":Q=T.left-6,P=T.top,M=V.get_parent(U),L=U.parent().index();break;case"i":b=V.settings.dnd.inside_pos,N=V.get_node(U.parent()),Q=T.left-2,P=T.top+O/2+1,M=N.id,L="first"===b?0:"last"===b?N.children.length:Math.min(b,N.children.length);break;case"a":Q=T.left-6,P=T.top+O,M=V.get_parent(U),L=U.parent().index()+1}for(J=!0,I=0,f=W.data.nodes.length;f>I;I++){if(e=W.data.origin&&(W.data.origin.settings.dnd.always_copy||W.data.origin.settings.dnd.copy&&(W.event.metaKey||W.event.ctrlKey))?"copy_node":"move_node",d=L,"move_node"===e&&"a"===k&&W.data.origin&&W.data.origin===V&&M===V.get_parent(W.data.nodes[I])&&(c=V.get_node(M),d>H.inArray(W.data.nodes[I],c.children)&&(d-=1)),J=J&&(V&&V.settings&&V.settings.dnd&&V.settings.dnd.check_while_dragging===!1||V.check(e,W.data.origin&&W.data.origin!==V?W.data.origin.get_node(W.data.nodes[I]):W.data.nodes[I],M,d,{dnd:!0,ref:V.get_node(U.parent()),pos:k,origin:W.data.origin,is_multi:W.data.origin&&W.data.origin!==V,is_foreign:!W.data.origin})),!J){V&&V.last_error&&(j=V.last_error());break}}return"i"===k&&U.parent().is(".jstree-closed")&&V.settings.dnd.open_timeout&&(h=setTimeout(function(n,m){return function(){n.open_node(m)}}(V,U),V.settings.dnd.open_timeout)),J?(a={ins:V,par:M,pos:"i"!==k||"last"!==b||0!==L||V.is_loaded(N)?L:"last"},g.css({left:Q+"px",top:P+"px"}).show(),W.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),j={},K=!0,!1):void 0}),K===!0)){return}}else{for(J=!0,I=0,f=W.data.nodes.length;f>I;I++){if(J=J&&V.check(W.data.origin&&(W.data.origin.settings.dnd.always_copy||W.data.origin.settings.dnd.copy&&(W.event.metaKey||W.event.ctrlKey))?"copy_node":"move_node",W.data.origin&&W.data.origin!==V?W.data.origin.get_node(W.data.nodes[I]):W.data.nodes[I],H.jstree.root,"last",{dnd:!0,ref:V.get_node(H.jstree.root),pos:"i",origin:W.data.origin,is_multi:W.data.origin&&W.data.origin!==V,is_foreign:!W.data.origin}),!J){break}}if(J){return a={ins:V,par:H.jstree.root,pos:"last"},g.hide(),void W.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok")}}}a=!1,W.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er"),g.hide()}}).on("dnd_scroll.vakata.jstree",function(b,d){d&&d.data&&d.data.jstree&&(g.hide(),a=!1,i=!1,d.helper.find(".jstree-icon").first().removeClass("jstree-ok").addClass("jstree-er"))}).on("dnd_stop.vakata.jstree",function(f,e){if(h&&clearTimeout(h),e&&e.data&&e.data.jstree){g.hide().detach();var d,c,b=[];if(a){for(d=0,c=e.data.nodes.length;c>d;d++){b[d]=e.data.origin?e.data.origin.get_node(e.data.nodes[d]):e.data.nodes[d]}a.ins[e.data.origin&&(e.data.origin.settings.dnd.always_copy||e.data.origin.settings.dnd.copy&&(e.event.metaKey||e.event.ctrlKey))?"copy_node":"move_node"](b,a.par,a.pos,!1,!1,!1,e.data.origin)}else{d=H(e.event.target).closest(".jstree"),d.length&&j&&j.error&&"check"===j.error&&(d=d.jstree(!0),d&&d.settings.core.error.call(this,j))}i=!1,a=!1}}).on("keyup.jstree keydown.jstree",function(d,e){e=H.vakata.dnd._get(),e&&e.data&&e.data.jstree&&(e.helper.find(".jstree-copy").first()[e.data.origin&&(e.data.origin.settings.dnd.always_copy||e.data.origin.settings.dnd.copy&&(d.metaKey||d.ctrlKey))?"show":"hide"](),i&&(i.metaKey=d.metaKey,i.ctrlKey=d.ctrlKey,H.vakata.dnd._trigger("move",i)))})}),function(d){d.vakata.html={div:d("<div />"),escape:function(a){return d.vakata.html.div.text(a).html()},strip:function(a){return d.vakata.html.div.empty().append(d.parseHTML(a)).text()}};var c={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1};d.vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,helper_left:5,helper_top:10,threshold:5,threshold_touch:50},_trigger:function(a,f){var e=d.vakata.dnd._get();e.event=f,d(z).triggerHandler("dnd_"+a+".vakata",e)},_get:function(){return{data:c.data,element:c.element,helper:c.helper}},_clean:function(){c.helper&&c.helper.remove(),c.scroll_i&&(clearInterval(c.scroll_i),c.scroll_i=!1),c={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1},d(z).off("mousemove.vakata.jstree touchmove.vakata.jstree",d.vakata.dnd.drag),d(z).off("mouseup.vakata.jstree touchend.vakata.jstree",d.vakata.dnd.stop)},_scroll:function(f){if(!c.scroll_e||!c.scroll_l&&!c.scroll_t){return c.scroll_i&&(clearInterval(c.scroll_i),c.scroll_i=!1),!1}if(!c.scroll_i){return c.scroll_i=setInterval(d.vakata.dnd._scroll,100),!1}if(f===!0){return !1}var b=c.scroll_e.scrollTop(),a=c.scroll_e.scrollLeft();c.scroll_e.scrollTop(b+c.scroll_t*d.vakata.dnd.settings.scroll_speed),c.scroll_e.scrollLeft(a+c.scroll_l*d.vakata.dnd.settings.scroll_speed),(b!==c.scroll_e.scrollTop()||a!==c.scroll_e.scrollLeft())&&d.vakata.dnd._trigger("scroll",c.scroll_e)},start:function(h,g,b){"touchstart"===h.type&&h.originalEvent&&h.originalEvent.changedTouches&&h.originalEvent.changedTouches[0]&&(h.pageX=h.originalEvent.changedTouches[0].pageX,h.pageY=h.originalEvent.changedTouches[0].pageY,h.target=z.elementFromPoint(h.originalEvent.changedTouches[0].pageX-window.pageXOffset,h.originalEvent.changedTouches[0].pageY-window.pageYOffset)),c.is_drag&&d.vakata.dnd.stop({});try{h.currentTarget.unselectable="on",h.currentTarget.onselectstart=function(){return !1},h.currentTarget.style&&(h.currentTarget.style.MozUserSelect="none")}catch(a){}return c.init_x=h.pageX,c.init_y=h.pageY,c.data=g,c.is_down=!0,c.element=h.currentTarget,c.target=h.target,c.is_touch="touchstart"===h.type,b!==!1&&(c.helper=d("<div id='vakata-dnd'></div>").html(b).css({display:"block",margin:"0",padding:"0",position:"absolute",top:"-2000px",lineHeight:"16px",zIndex:"10000"})),d(z).on("mousemove.vakata.jstree touchmove.vakata.jstree",d.vakata.dnd.drag),d(z).on("mouseup.vakata.jstree touchend.vakata.jstree",d.vakata.dnd.stop),!1},drag:function(M){if("touchmove"===M.type&&M.originalEvent&&M.originalEvent.changedTouches&&M.originalEvent.changedTouches[0]&&(M.pageX=M.originalEvent.changedTouches[0].pageX,M.pageY=M.originalEvent.changedTouches[0].pageY,M.target=z.elementFromPoint(M.originalEvent.changedTouches[0].pageX-window.pageXOffset,M.originalEvent.changedTouches[0].pageY-window.pageYOffset)),c.is_down){if(!c.is_drag){if(!(Math.abs(M.pageX-c.init_x)>(c.is_touch?d.vakata.dnd.settings.threshold_touch:d.vakata.dnd.settings.threshold)||Math.abs(M.pageY-c.init_y)>(c.is_touch?d.vakata.dnd.settings.threshold_touch:d.vakata.dnd.settings.threshold))){return}c.helper&&(c.helper.appendTo("body"),c.helper_w=c.helper.outerWidth()),c.is_drag=!0,d.vakata.dnd._trigger("start",M)}var L=!1,K=!1,J=!1,I=!1,q=!1,p=!1,o=!1,i=!1,b=!1,a=!1;return c.scroll_t=0,c.scroll_l=0,c.scroll_e=!1,d(d(M.target).parentsUntil("body").addBack().get().reverse()).filter(function(){return/^auto|scroll$/.test(d(this).css("overflow"))&&(this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth)}).each(function(){var g=d(this),f=g.offset();return this.scrollHeight>this.offsetHeight&&(f.top+g.height()-M.pageY<d.vakata.dnd.settings.scroll_proximity&&(c.scroll_t=1),M.pageY-f.top<d.vakata.dnd.settings.scroll_proximity&&(c.scroll_t=-1)),this.scrollWidth>this.offsetWidth&&(f.left+g.width()-M.pageX<d.vakata.dnd.settings.scroll_proximity&&(c.scroll_l=1),M.pageX-f.left<d.vakata.dnd.settings.scroll_proximity&&(c.scroll_l=-1)),c.scroll_t||c.scroll_l?(c.scroll_e=d(this),!1):void 0}),c.scroll_e||(L=d(z),K=d(window),J=L.height(),I=K.height(),q=L.width(),p=K.width(),o=L.scrollTop(),i=L.scrollLeft(),J>I&&M.pageY-o<d.vakata.dnd.settings.scroll_proximity&&(c.scroll_t=-1),J>I&&I-(M.pageY-o)<d.vakata.dnd.settings.scroll_proximity&&(c.scroll_t=1),q>p&&M.pageX-i<d.vakata.dnd.settings.scroll_proximity&&(c.scroll_l=-1),q>p&&p-(M.pageX-i)<d.vakata.dnd.settings.scroll_proximity&&(c.scroll_l=1),(c.scroll_t||c.scroll_l)&&(c.scroll_e=L)),c.scroll_e&&d.vakata.dnd._scroll(!0),c.helper&&(b=parseInt(M.pageY+d.vakata.dnd.settings.helper_top,10),a=parseInt(M.pageX+d.vakata.dnd.settings.helper_left,10),J&&b+25>J&&(b=J-50),q&&a+c.helper_w>q&&(a=q-(c.helper_w+2)),c.helper.css({left:a+"px",top:b+"px"})),d.vakata.dnd._trigger("move",M),!1}},stop:function(b){if("touchend"===b.type&&b.originalEvent&&b.originalEvent.changedTouches&&b.originalEvent.changedTouches[0]&&(b.pageX=b.originalEvent.changedTouches[0].pageX,b.pageY=b.originalEvent.changedTouches[0].pageY,b.target=z.elementFromPoint(b.originalEvent.changedTouches[0].pageX-window.pageXOffset,b.originalEvent.changedTouches[0].pageY-window.pageYOffset)),c.is_drag){d.vakata.dnd._trigger("stop",b)}else{if("touchend"===b.type&&b.target===c.target){var a=setTimeout(function(){d(b.target).click()},100);d(b.target).one("click",function(){a&&clearTimeout(a)})}}return d.vakata.dnd._clean(),!1}}}(H),H.jstree.defaults.massload=null,H.jstree.plugins.massload=function(a,d){this.init=function(e,c){d.init.call(this,e,c),this._data.massload={}},this._load_nodes=function(c,i,h){var g=this.settings.massload;return h&&!H.isEmptyObject(this._data.massload)?d._load_nodes.call(this,c,i,h):H.isFunction(g)?g.call(this,c,H.proxy(function(b){if(b){for(var e in b){b.hasOwnProperty(e)&&(this._data.massload[e]=b[e])}}d._load_nodes.call(this,c,i,h)},this)):"object"==typeof g&&g&&g.url?(g=H.extend(!0,{},g),H.isFunction(g.url)&&(g.url=g.url.call(this,c)),H.isFunction(g.data)&&(g.data=g.data.call(this,c)),H.ajax(g).done(H.proxy(function(b,k,j){if(b){for(var e in b){b.hasOwnProperty(e)&&(this._data.massload[e]=b[e])}}d._load_nodes.call(this,c,i,h)},this)).fail(H.proxy(function(b){d._load_nodes.call(this,c,i,h)},this))):d._load_nodes.call(this,c,i,h)},this._load_node=function(c,g){var f=this._data.massload[c.id];return f?this["string"==typeof f?"_append_html_data":"_append_json_data"](c,"string"==typeof f?H(H.parseHTML(f)).filter(function(){return 3!==this.nodeType}):f,function(b){g.call(this,b),delete this._data.massload[c.id]}):d._load_node.call(this,c,g)}},H.jstree.defaults.search={ajax:!1,fuzzy:!1,case_sensitive:!1,show_only_matches:!1,show_only_matches_children:!1,close_opened_onclear:!0,search_leaves_only:!1,search_callback:!1},H.jstree.plugins.search=function(b,a){this.bind=function(){a.bind.call(this),this._data.search.str="",this._data.search.dom=H(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=!1,this._data.search.smc=!1,this._data.search.hdn=[],this.element.on("search.jstree",H.proxy(function(h,m){if(this._data.search.som&&m.res.length){var l=this._model.data,k,j,i=[];for(k=0,j=m.res.length;j>k;k++){l[m.res[k]]&&!l[m.res[k]].state.hidden&&(i.push(m.res[k]),i=i.concat(l[m.res[k]].parents),this._data.search.smc&&(i=i.concat(l[m.res[k]].children_d)))}i=H.vakata.array_remove_item(H.vakata.array_unique(i),H.jstree.root),this._data.search.hdn=this.hide_all(!0),this.show_node(i)}},this)).on("clear_search.jstree",H.proxy(function(d,c){this._data.search.som&&c.res.length&&this.show_node(this._data.search.hdn)},this))},this.search=function(U,T,S,R,Q,P){if(U===!1||""===H.trim(U.toString())){return this.clear_search()}R=this.get_node(R),R=R&&R.id?R.id:null,U=U.toString();var O=this.settings.search,N=O.ajax?O.ajax:!1,M=this._model.data,L=null,K=[],J=[],I,q;if(this._data.search.res.length&&!Q&&this.clear_search(),S===G&&(S=O.show_only_matches),P===G&&(P=O.show_only_matches_children),!T&&N!==!1){return H.isFunction(N)?N.call(this,U,H.proxy(function(c){c&&c.d&&(c=c.d),this._load_nodes(H.isArray(c)?H.vakata.array_unique(c):[],function(){this.search(U,!0,S,R,Q)},!0)},this),R):(N=H.extend({},N),N.data||(N.data={}),N.data.str=U,R&&(N.data.inside=R),H.ajax(N).fail(H.proxy(function(){this._data.core.last_error={error:"ajax",plugin:"search",id:"search_01",reason:"Could not load search parents",data:JSON.stringify(N)},this.settings.core.error.call(this,this._data.core.last_error)},this)).done(H.proxy(function(c){c&&c.d&&(c=c.d),this._load_nodes(H.isArray(c)?H.vakata.array_unique(c):[],function(){this.search(U,!0,S,R,Q)},!0)},this)))}if(Q||(this._data.search.str=U,this._data.search.dom=H(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=S,this._data.search.smc=P),L=new H.vakata.search(U,!0,{caseSensitive:O.case_sensitive,fuzzy:O.fuzzy}),H.each(M[R?R:H.jstree.root].children_d,function(e,c){var f=M[c];f.text&&(!O.search_leaves_only||f.state.loaded&&0===f.children.length)&&(O.search_callback&&O.search_callback.call(this,U,f)||!O.search_callback&&L.search(f.text).isMatch)&&(K.push(c),J=J.concat(f.parents))}),K.length){for(J=H.vakata.array_unique(J),I=0,q=J.length;q>I;I++){J[I]!==H.jstree.root&&M[J[I]]&&this.open_node(J[I],null,0)===!0&&this._data.search.opn.push(J[I])}Q?(this._data.search.dom=this._data.search.dom.add(H(this.element[0].querySelectorAll("#"+H.map(K,function(c){return -1!=="0123456789".indexOf(c[0])?"\\3"+c[0]+" "+c.substr(1).replace(H.jstree.idregex,"\\$&"):c.replace(H.jstree.idregex,"\\$&")}).join(", #")))),this._data.search.res=H.vakata.array_unique(this._data.search.res.concat(K))):(this._data.search.dom=H(this.element[0].querySelectorAll("#"+H.map(K,function(c){return -1!=="0123456789".indexOf(c[0])?"\\3"+c[0]+" "+c.substr(1).replace(H.jstree.idregex,"\\$&"):c.replace(H.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.res=K),this._data.search.dom.children(".jstree-anchor").addClass("jstree-search")}this.trigger("search",{nodes:this._data.search.dom,str:U,res:this._data.search.res,show_only_matches:S})},this.clear_search=function(){this.settings.search.close_opened_onclear&&this.close_node(this._data.search.opn,0),this.trigger("clear_search",{nodes:this._data.search.dom,str:this._data.search.str,res:this._data.search.res}),this._data.search.res.length&&(this._data.search.dom=H(this.element[0].querySelectorAll("#"+H.map(this._data.search.res,function(c){return -1!=="0123456789".indexOf(c[0])?"\\3"+c[0]+" "+c.substr(1).replace(H.jstree.idregex,"\\$&"):c.replace(H.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.dom.children(".jstree-anchor").removeClass("jstree-search")),this._data.search.str="",this._data.search.res=[],this._data.search.opn=[],this._data.search.dom=H()},this.redraw_node=function(d,o,n,m){if(d=a.redraw_node.apply(this,arguments),d&&-1!==H.inArray(d.id,this._data.search.res)){var l,k,j=null;for(l=0,k=d.childNodes.length;k>l;l++){if(d.childNodes[l]&&d.childNodes[l].className&&-1!==d.childNodes[l].className.indexOf("jstree-anchor")){j=d.childNodes[l];break}}j&&(j.className+=" jstree-search")}return d}},function(b){b.vakata.search=function(M,L,K){K=K||{},K=b.extend({},b.vakata.search.defaults,K),K.fuzzy!==!1&&(K.fuzzy=!0),M=K.caseSensitive?M:M.toLowerCase();var J=K.location,I=K.distance,q=K.threshold,p=M.length,o,n,m,a;return p>32&&(K.fuzzy=!1),K.fuzzy&&(o=1<<p-1,n=function(){var d={},e=0;for(e=0;p>e;e++){d[M.charAt(e)]=0}for(e=0;p>e;e++){d[M.charAt(e)]|=1<<p-e-1}return d}(),m=function(f,e){var h=f/p,g=Math.abs(J-e);return I?h+g/I:g?1:h}),a=function(Q){if(Q=K.caseSensitive?Q:Q.toLowerCase(),M===Q||-1!==Q.indexOf(M)){return{isMatch:!0,score:0}}if(!K.fuzzy){return{isMatch:!1,score:1}}var O,N,k=Q.length,j=q,i=Q.indexOf(M,J),h,g,e=p+k,d,V,U,T,S,R=1,P=[];for(-1!==i&&(j=Math.min(m(0,i),j),i=Q.lastIndexOf(M,J+p),-1!==i&&(j=Math.min(m(0,i),j))),i=-1,O=0;p>O;O++){h=0,g=e;while(g>h){m(O,J+g)<=j?h=g:e=g,g=Math.floor((e-h)/2+h)}for(e=g,V=Math.max(1,J-g+1),U=Math.min(J+g,k)+p,T=new Array(U+2),T[U+1]=(1<<O)-1,N=U;N>=V;N--){if(S=n[Q.charAt(N-1)],0===O?T[N]=(T[N+1]<<1|1)&S:T[N]=(T[N+1]<<1|1)&S|((d[N+1]|d[N])<<1|1)|d[N+1],T[N]&o&&(R=m(O,N-1),j>=R)){if(j=R,i=N-1,P.push(i),!(i>J)){break}V=Math.max(1,2*J-i)}}if(m(O+1,J)>j){break}d=T}return{isMatch:i>=0,score:R}},L===!0?{search:a}:a(L)},b.vakata.search.defaults={location:0,distance:100,threshold:0.6,fuzzy:!1,caseSensitive:!1}}(H),H.jstree.defaults.sort=function(d,c){return this.get_text(d)>this.get_text(c)?1:-1},H.jstree.plugins.sort=function(a,d){this.bind=function(){d.bind.call(this),this.element.on("model.jstree",H.proxy(function(e,c){this.sort(c.parent,!0)},this)).on("rename_node.jstree create_node.jstree",H.proxy(function(e,c){this.sort(c.parent||c.node.parent,!1),this.redraw_node(c.parent||c.node.parent,!0)},this)).on("move_node.jstree copy_node.jstree",H.proxy(function(e,c){this.sort(c.parent,!1),this.redraw_node(c.parent,!0)},this))},this.sort=function(f,i){var h,g;if(f=this.get_node(f),f&&f.children&&f.children.length&&(f.children.sort(H.proxy(this.settings.sort,this)),i)){for(h=0,g=f.children_d.length;g>h;h++){this.sort(f.children_d[h],!1)}}}};var u=!1;H.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree check_node.jstree uncheck_node.jstree",ttl:!1,filter:!1},H.jstree.plugins.state=function(a,d){this.bind=function(){d.bind.call(this);var c=H.proxy(function(){this.element.on(this.settings.state.events,H.proxy(function(){u&&clearTimeout(u),u=setTimeout(H.proxy(function(){this.save_state()},this),100)},this)),this.trigger("state_ready")},this);this.element.on("ready.jstree",H.proxy(function(b,e){this.element.one("restore_state.jstree",c),this.restore_state()||c()},this))},this.save_state=function(){var c={state:this.get_state(),ttl:this.settings.state.ttl,sec:+new Date};H.vakata.storage.set(this.settings.state.key,JSON.stringify(c))},this.restore_state=function(){var e=H.vakata.storage.get(this.settings.state.key);if(e){try{e=JSON.parse(e)}catch(f){return !1}}return e&&e.ttl&&e.sec&&+new Date-e.sec>e.ttl?!1:(e&&e.state&&(e=e.state),e&&H.isFunction(this.settings.state.filter)&&(e=this.settings.state.filter.call(this,e)),e?(this.element.one("set_state.jstree",function(g,b){b.instance.trigger("restore_state",{state:H.extend(!0,{},e)})}),this.set_state(e),!0):!1)},this.clear_state=function(){return H.vakata.storage.del(this.settings.state.key)}},function(d,c){d.vakata.storage={set:function(f,e){return window.localStorage.setItem(f,e)},get:function(b){return window.localStorage.getItem(b)},del:function(b){return window.localStorage.removeItem(b)}}}(H),H.jstree.defaults.types={"default":{}},H.jstree.defaults.types[H.jstree.root]={},H.jstree.plugins.types=function(b,a){this.init=function(j,i){var h,d;if(i&&i.types&&i.types["default"]){for(h in i.types){if("default"!==h&&h!==H.jstree.root&&i.types.hasOwnProperty(h)){for(d in i.types["default"]){i.types["default"].hasOwnProperty(d)&&i.types[h][d]===G&&(i.types[h][d]=i.types["default"][d])}}}}a.init.call(this,j,i),this._model.data[H.jstree.root].type=H.jstree.root},this.refresh=function(d,e){a.refresh.call(this,d,e),this._model.data[H.jstree.root].type=H.jstree.root},this.bind=function(){this.element.on("model.jstree",H.proxy(function(I,q){var p=this._model.data,o=q.nodes,n=this.settings.types,m,l,k="default";for(m=0,l=o.length;l>m;m++){k="default",p[o[m]].original&&p[o[m]].original.type&&n[p[o[m]].original.type]&&(k=p[o[m]].original.type),p[o[m]].data&&p[o[m]].data.jstree&&p[o[m]].data.jstree.type&&n[p[o[m]].data.jstree.type]&&(k=p[o[m]].data.jstree.type),p[o[m]].type=k,p[o[m]].icon===!0&&n[k].icon!==G&&(p[o[m]].icon=n[k].icon)}p[H.jstree.root].type=H.jstree.root},this)),a.bind.call(this)},this.get_json=function(d,q,p){var o,n,m=this._model.data,l=q?H.extend(!0,{},q,{no_id:!1}):{},k=a.get_json.call(this,d,l,p);if(k===!1){return !1}if(H.isArray(k)){for(o=0,n=k.length;n>o;o++){k[o].type=k[o].id&&m[k[o].id]&&m[k[o].id].type?m[k[o].id].type:"default",q&&q.no_id&&(delete k[o].id,k[o].li_attr&&k[o].li_attr.id&&delete k[o].li_attr.id,k[o].a_attr&&k[o].a_attr.id&&delete k[o].a_attr.id)}}else{k.type=k.id&&m[k.id]&&m[k.id].type?m[k.id].type:"default",q&&q.no_id&&(k=this._delete_ids(k))}return k},this._delete_ids=function(e){if(H.isArray(e)){for(var g=0,f=e.length;f>g;g++){e[g]=this._delete_ids(e[g])}return e}return delete e.id,e.li_attr&&e.li_attr.id&&delete e.li_attr.id,e.a_attr&&e.a_attr.id&&delete e.a_attr.id,e.children&&H.isArray(e.children)&&(e.children=this._delete_ids(e.children)),e},this.check=function(M,L,K,J,I){if(a.check.call(this,M,L,K,J,I)===!1){return !1}L=L&&L.id?L:this.get_node(L),K=K&&K.id?K:this.get_node(K);var q=L&&L.id?I&&I.origin?I.origin:H.jstree.reference(L.id):null,p,o,n,d;switch(q=q&&q._model&&q._model.data?q._model.data:null,M){case"create_node":case"move_node":case"copy_node":if("move_node"!==M||-1===H.inArray(L.id,K.children)){if(p=this.get_rules(K),p.max_children!==G&&-1!==p.max_children&&p.max_children===K.children.length){return this._data.core.last_error={error:"check",plugin:"types",id:"types_01",reason:"max_children prevents function: "+M,data:JSON.stringify({chk:M,pos:J,obj:L&&L.id?L.id:!1,par:K&&K.id?K.id:!1})},!1}if(p.valid_children!==G&&-1!==p.valid_children&&-1===H.inArray(L.type||"default",p.valid_children)){return this._data.core.last_error={error:"check",plugin:"types",id:"types_02",reason:"valid_children prevents function: "+M,data:JSON.stringify({chk:M,pos:J,obj:L&&L.id?L.id:!1,par:K&&K.id?K.id:!1})},!1}if(q&&L.children_d&&L.parents){for(o=0,n=0,d=L.children_d.length;d>n;n++){o=Math.max(o,q[L.children_d[n]].parents.length)}o=o-L.parents.length+1}(0>=o||o===G)&&(o=1);do{if(p.max_depth!==G&&-1!==p.max_depth&&p.max_depth<o){return this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+M,data:JSON.stringify({chk:M,pos:J,obj:L&&L.id?L.id:!1,par:K&&K.id?K.id:!1})},!1}K=this.get_node(K.parent),p=this.get_rules(K),o++}while(K)}}return !0},this.get_rules=function(d){if(d=this.get_node(d),!d){return !1}var e=this.get_type(d,!0);return e.max_depth===G&&(e.max_depth=-1),e.max_children===G&&(e.max_children=-1),e.valid_children===G&&(e.valid_children=-1),e},this.get_type=function(d,e){return d=this.get_node(d),d?e?H.extend({type:d.type},this.settings.types[d.type]):d.type:!1},this.set_type=function(p,o){var n,m,l,k,j;if(H.isArray(p)){for(p=p.slice(),m=0,l=p.length;l>m;m++){this.set_type(p[m],o)}return !0}return n=this.settings.types,p=this.get_node(p),n[o]&&p?(k=p.type,j=this.get_icon(p),p.type=o,(j===!0||n[k]&&n[k].icon!==G&&j===n[k].icon)&&this.set_icon(p,n[o].icon!==G?n[o].icon:!0),!0):!1}},H.jstree.defaults.unique={case_sensitive:!1,duplicate:function(d,c){return d+" ("+c+")"}},H.jstree.plugins.unique=function(b,a){this.check=function(N,M,L,K,J){if(a.check.call(this,N,M,L,K,J)===!1){return !1}if(M=M&&M.id?M:this.get_node(M),L=L&&L.id?L:this.get_node(L),!L||!L.children){return !0}var I="rename_node"===N?K:M.text,q=[],p=this.settings.unique.case_sensitive,o=this._model.data,n,d;for(n=0,d=L.children.length;d>n;n++){q.push(p?o[L.children[n]].text:o[L.children[n]].text.toLowerCase())}switch(p||(I=I.toLowerCase()),N){case"delete_node":return !0;case"rename_node":return n=-1===H.inArray(I,q)||M.text&&M.text[p?"toString":"toLowerCase"]()===I,n||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+I+" already exists. Preventing: "+N,data:JSON.stringify({chk:N,pos:K,obj:M&&M.id?M.id:!1,par:L&&L.id?L.id:!1})}),n;case"create_node":return n=-1===H.inArray(I,q),n||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_04",reason:"Child with name "+I+" already exists. Preventing: "+N,data:JSON.stringify({chk:N,pos:K,obj:M&&M.id?M.id:!1,par:L&&L.id?L.id:!1})}),n;case"copy_node":return n=-1===H.inArray(I,q),n||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_02",reason:"Child with name "+I+" already exists. Preventing: "+N,data:JSON.stringify({chk:N,pos:K,obj:M&&M.id?M.id:!1,par:L&&L.id?L.id:!1})}),n;case"move_node":return n=M.parent===L.id&&(!J||!J.is_multi)||-1===H.inArray(I,q),n||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_03",reason:"Child with name "+I+" already exists. Preventing: "+N,data:JSON.stringify({chk:N,pos:K,obj:M&&M.id?M.id:!1,par:L&&L.id?L.id:!1})}),n}return !0},this.create_node=function(S,R,Q,P,O){if(!R||R.text===G){if(null===S&&(S=H.jstree.root),S=this.get_node(S),!S){return a.create_node.call(this,S,R,Q,P,O)}if(Q=Q===G?"last":Q,!Q.toString().match(/^(before|after)$/)&&!O&&!this.is_loaded(S)){return a.create_node.call(this,S,R,Q,P,O)}R||(R={});var N,M,L,K,J,I=this._model.data,q=this.settings.unique.case_sensitive,d=this.settings.unique.duplicate;for(M=N=this.get_string("New node"),L=[],K=0,J=S.children.length;J>K;K++){L.push(q?I[S.children[K]].text:I[S.children[K]].text.toLowerCase())}K=1;while(-1!==H.inArray(q?M:M.toLowerCase(),L)){M=d.call(this,N,++K).toString()}R.text=M}return a.create_node.call(this,S,R,Q,P,O)}};var t=z.createElement("DIV");if(t.setAttribute("unselectable","on"),t.setAttribute("role","presentation"),t.className="jstree-wholerow",t.innerHTML="&#160;",H.jstree.plugins.wholerow=function(a,d){this.bind=function(){d.bind.call(this),this.element.on("ready.jstree set_state.jstree",H.proxy(function(){this.hide_dots()},this)).on("init.jstree loading.jstree ready.jstree",H.proxy(function(){this.get_container_ul().addClass("jstree-wholerow-ul")},this)).on("deselect_all.jstree",H.proxy(function(e,c){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked")},this)).on("changed.jstree",H.proxy(function(g,f){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked");var j=!1,i,h;for(i=0,h=f.selected.length;h>i;i++){j=this.get_node(f.selected[i],!0),j&&j.length&&j.children(".jstree-wholerow").addClass("jstree-wholerow-clicked")}},this)).on("open_node.jstree",H.proxy(function(e,c){this.get_node(c.node,!0).find(".jstree-clicked").parent().children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("hover_node.jstree dehover_node.jstree",H.proxy(function(e,c){"hover_node"===e.type&&this.is_disabled(c.node)||this.get_node(c.node,!0).children(".jstree-wholerow")["hover_node"===e.type?"addClass":"removeClass"]("jstree-wholerow-hovered")},this)).on("contextmenu.jstree",".jstree-wholerow",H.proxy(function(e){e.preventDefault();var f=H.Event("contextmenu",{metaKey:e.metaKey,ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey,pageX:e.pageX,pageY:e.pageY});H(e.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(f)},this)).on("click.jstree",".jstree-wholerow",function(e){e.stopImmediatePropagation();var f=H.Event("click",{metaKey:e.metaKey,ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey});H(e.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(f).focus()}).on("click.jstree",".jstree-leaf > .jstree-ocl",H.proxy(function(e){e.stopImmediatePropagation();var f=H.Event("click",{metaKey:e.metaKey,ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey});H(e.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(f).focus()},this)).on("mouseover.jstree",".jstree-wholerow, .jstree-icon",H.proxy(function(b){return b.stopImmediatePropagation(),this.is_disabled(b.currentTarget)||this.hover_node(b.currentTarget),!1},this)).on("mouseleave.jstree",".jstree-node",H.proxy(function(b){this.dehover_node(b.currentTarget)},this))},this.teardown=function(){this.settings.wholerow&&this.element.find(".jstree-wholerow").remove(),d.teardown.call(this)},this.redraw_node=function(c,k,j,i){if(c=d.redraw_node.apply(this,arguments)){var h=t.cloneNode(!0);-1!==H.inArray(c.id,this._data.core.selected)&&(h.className+=" jstree-wholerow-clicked"),this._data.core.focused&&this._data.core.focused===c.id&&(h.className+=" jstree-wholerow-hovered"),c.insertBefore(h,c.childNodes[0])}return c}},z.registerElement&&Object&&Object.create){var s=Object.create(HTMLElement.prototype);s.createdCallback=function(){var a={core:{},plugins:[]},d;for(d in H.jstree.plugins){H.jstree.plugins.hasOwnProperty(d)&&this.attributes[d]&&(a.plugins.push(d),this.getAttribute(d)&&JSON.parse(this.getAttribute(d))&&(a[d]=JSON.parse(this.getAttribute(d))))}for(d in H.jstree.defaults.core){H.jstree.defaults.core.hasOwnProperty(d)&&this.attributes[d]&&(a.core[d]=JSON.parse(this.getAttribute(d))||this.getAttribute(d))}H(this).jstree(a)};try{z.registerElement("vakata-jstree",{prototype:s})}catch(r){}}}});
!function(a){a.Jcrop=function(e,B){function n(au){return Math.round(au)+"px"}function D(au){return I.baseClass+"-"+au}function E(){return a.fx.step.hasOwnProperty("backgroundColor")}function F(au){var av=a(au).offset();return[av.left,av.top]}function G(au){return[au.pageX-af[0],au.pageY-af[1]]}function A(au){"object"!=typeof au&&(au={}),I=a.extend(I,au),a.each(["onChange","onSelect","onRelease","onDblClick"],function(av,aw){"function"!=typeof I[aw]&&(I[aw]=function(){})})}function g(aw,az,ay){if(af=F(ar),P.setCursor("move"===aw?aw:aw+"-resize"),"move"===aw){return P.activateHandlers(R(az),q,ay)}var au=aa.getFixed(),av=s(aw),ax=aa.getCorner(s(av));aa.setPressed(aa.getCorner(av)),aa.setCurrent(ax),P.activateHandlers(H(aw,au),q,ay)}function H(av,au){return function(aw){if(I.aspectRatio){switch(av){case"e":aw[1]=au.y+1;break;case"w":aw[1]=au.y+1;break;case"n":aw[0]=au.x+1;break;case"s":aw[0]=au.x+1}}else{switch(av){case"e":aw[1]=au.y2;break;case"w":aw[1]=au.y2;break;case"n":aw[0]=au.x2;break;case"s":aw[0]=au.x2}}aa.setCurrent(aw),V.update()}}function R(av){var au=av;return aq.watchKeys(),function(aw){aa.moveOffset([aw[0]-au[0],aw[1]-au[1]]),au=aw,V.update()}}function s(au){switch(au){case"n":return"sw";case"s":return"nw";case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function c(au){return function(av){return I.disabled?!1:"move"!==au||I.allowMove?(af=F(ar),r=!0,g(au,G(av)),av.stopPropagation(),av.preventDefault(),!1):!1}}function U(ay,av,ax){var au=ay.width(),aw=ay.height();au>av&&av>0&&(au=av,aw=av/ay.width()*ay.height()),aw>ax&&ax>0&&(aw=ax,au=ax/ay.height()*ay.width()),M=ay.width()/au,f=ay.height()/aw,ay.width(au).height(aw)}function Y(au){return{x:au.x*M,y:au.y*f,x2:au.x2*M,y2:au.y2*f,w:au.w*M,h:au.h*f}}function q(){var au=aa.getFixed();au.w>I.minSelect[0]&&au.h>I.minSelect[1]?(V.enableHandles(),V.done()):V.release(),P.setCursor(I.allowSelect?"crosshair":"default")}function ae(au){if(!I.disabled&&I.allowSelect){r=!0,af=F(ar),V.disableHandles(),P.setCursor("crosshair");var av=G(au);return aa.setPressed(av),V.update(),P.activateHandlers(ap,q,"touch"===au.type.substring(0,5)),aq.watchKeys(),au.stopPropagation(),au.preventDefault(),!1}}function ap(au){aa.setCurrent(au),V.update()}function ag(){var au=a("<div></div>").addClass(D("tracker"));return ac&&au.css({opacity:0,backgroundColor:"white"}),au}function m(au){Z.removeClass().addClass(D("holder")).addClass(au)}function v(aM,aA){function aC(){window.setTimeout(aL,aw)}var aG=aM[0]/M,av=aM[1]/f,aF=aM[2]/M,au=aM[3]/f;if(!C){var aE=aa.flipCoords(aG,av,aF,au),aK=aa.getFixed(),aH=[aK.x,aK.y,aK.x2,aK.y2],ax=aH,aw=I.animationDelay,aJ=aE[0]-aH[0],az=aE[1]-aH[1],aI=aE[2]-aH[2],ay=aE[3]-aH[3],aD=0,aB=I.swingSpeed;aG=ax[0],av=ax[1],aF=ax[2],au=ax[3],V.animMode(!0);var aL=function(){return function(){aD+=(100-aD)/aB,ax[0]=Math.round(aG+aD/100*aJ),ax[1]=Math.round(av+aD/100*az),ax[2]=Math.round(aF+aD/100*aI),ax[3]=Math.round(au+aD/100*ay),aD>=99.8&&(aD=100),100>aD?(an(ax),aC()):(V.done(),V.animMode(!1),"function"==typeof aA&&aA.call(i))}}();aC()}}function L(au){an([au[0]/M,au[1]/f,au[2]/M,au[3]/f]),I.onSelect.call(i,Y(aa.getFixed())),V.enableHandles()}function an(au){aa.setPressed([au[0],au[1]]),aa.setCurrent([au[2],au[3]]),V.update()}function k(){return Y(aa.getFixed())}function al(){return aa.getFixed()}function w(au){A(au),N()}function x(){I.disabled=!0,V.disableHandles(),V.setCursor("default"),P.setCursor("default")}function X(){I.disabled=!1,N()}function o(){V.done(),P.activateHandlers(null,null)}function aj(){Z.remove(),W.show(),W.css("visibility","visible"),a(e).removeData("Jcrop")}function at(av,aw){V.release(),x();var au=new Image;au.onload=function(){var ax=au.width,az=au.height,aA=I.boxWidth,ay=I.boxHeight;ar.width(ax).height(az),ar.attr("src",av),J.attr("src",av),U(ar,aA,ay),Q=ar.width(),O=ar.height(),J.width(Q).height(O),b.width(Q+2*t).height(O+2*t),Z.width(Q).height(O),d.resize(Q,O),X(),"function"==typeof aw&&aw.call(i)},au.src=av}function h(ax,au,av){var aw=au||I.bgColor;I.bgFade&&E()&&I.fadeTime&&!av?ax.animate({backgroundColor:aw},{queue:!1,duration:I.fadeTime}):ax.css("backgroundColor",aw)}function N(au){I.allowResize?au?V.enableOnly():V.enableHandles():V.disableHandles(),P.setCursor(I.allowSelect?"crosshair":"default"),V.setCursor(I.allowMove?"move":"default"),I.hasOwnProperty("trueSize")&&(M=I.trueSize[0]/Q,f=I.trueSize[1]/O),I.hasOwnProperty("setSelect")&&(L(I.setSelect),V.done(),delete I.setSelect),d.refresh(),I.bgColor!=ao&&(h(I.shade?d.getShades():Z,I.shade?I.shadeColor||I.bgColor:I.bgColor),ao=I.bgColor),ab!=I.bgOpacity&&(ab=I.bgOpacity,I.shade?d.refresh():V.setBgOpacity(ab)),y=I.maxSize[0]||0,am=I.maxSize[1]||0,p=I.minSize[0]||0,T=I.minSize[1]||0,I.hasOwnProperty("outerImage")&&(ar.attr("src",I.outerImage),delete I.outerImage),V.refresh()}var af,I=a.extend({},a.Jcrop.defaults),ai=navigator.userAgent.toLowerCase(),ac=/msie/.test(ai),ah=/msie [1-6]\./.test(ai);"object"!=typeof e&&(e=a(e)[0]),"object"!=typeof B&&(B={}),A(B);var j={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute",top:0,left:0},W=a(e),ak=!0;if("IMG"==e.tagName){if(0!=W[0].width&&0!=W[0].height){W.width(W[0].width),W.height(W[0].height)}else{var u=new Image;u.src=W[0].src,W.width(u.width),W.height(u.height)}var ar=W.clone().removeAttr("id").css(j).show();ar.width(W.width()),ar.height(W.height()),W.after(ar).hide()}else{ar=W.css(j).show(),ak=!1,null===I.shade&&(I.shade=!0)}U(ar,I.boxWidth,I.boxHeight);var Q=ar.width(),O=ar.height(),Z=a("<div />").width(Q).height(O).addClass(D("holder")).css({position:"relative",backgroundColor:I.bgColor}).insertAfter(W).append(ar);I.addClass&&Z.addClass(I.addClass);var J=a("<div />"),l=a("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),K=a("<div />").width("100%").height("100%").css("zIndex",320),z=a("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var au=aa.getFixed();I.onDblClick.call(i,au)}).insertBefore(ar).append(l,K);ak&&(J=a("<img />").attr("src",ar.attr("src")).css(j).width(Q).height(O),l.append(J)),ah&&z.css({overflowY:"hidden"});var y,am,p,T,M,f,r,C,ad,t=I.boundary,b=ag().width(Q+2*t).height(O+2*t).css({position:"absolute",top:n(-t),left:n(-t),zIndex:290}).mousedown(ae),ao=I.bgColor,ab=I.bgOpacity;af=F(ar);var S=function(){function au(){var az,aB={},ay=["touchstart","touchmove","touchend"],aA=document.createElement("div");try{for(az=0;az<ay.length;az++){var aw=ay[az];aw="on"+aw;var ax=aw in aA;ax||(aA.setAttribute(aw,"return;"),ax="function"==typeof aA[aw]),aB[ay[az]]=ax}return aB.touchstart&&aB.touchend&&aB.touchmove}catch(aC){return !1}}function av(){return I.touchSupport===!0||I.touchSupport===!1?I.touchSupport:au()}return{createDragger:function(aw){return function(ax){return I.disabled?!1:"move"!==aw||I.allowMove?(af=F(ar),r=!0,g(aw,G(S.cfilter(ax)),!0),ax.stopPropagation(),ax.preventDefault(),!1):!1}},newSelection:function(aw){return ae(S.cfilter(aw))},cfilter:function(aw){return aw.pageX=aw.originalEvent.changedTouches[0].pageX,aw.pageY=aw.originalEvent.changedTouches[0].pageY,aw},isSupported:au,support:av()}}(),aa=function(){function aB(aK){aK=az(aK),av=aw=aK[0],aE=aH=aK[1]}function aA(aK){aK=az(aK),ay=aK[0]-av,ax=aK[1]-aE,av=aK[0],aE=aK[1]}function aJ(){return[ay,ax]}function au(aM){var aL=aM[0],aK=aM[1];0>aw+aL&&(aL-=aL+aw),0>aH+aK&&(aK-=aK+aH),aE+aK>O&&(aK+=O-(aE+aK)),av+aL>Q&&(aL+=Q-(av+aL)),aw+=aL,av+=aL,aH+=aK,aE+=aK}function aC(aK){var aL=aI();switch(aK){case"ne":return[aL.x2,aL.y];case"nw":return[aL.x,aL.y];case"se":return[aL.x2,aL.y2];case"sw":return[aL.x,aL.y2]}}function aI(){if(!I.aspectRatio){return aG()}var aK,aS,aV,aQ,aM=I.aspectRatio,aT=I.minSize[0]/M,aL=I.maxSize[0]/M,aW=I.maxSize[1]/f,aO=av-aw,aU=aE-aH,aN=Math.abs(aO),aP=Math.abs(aU),aR=aN/aP;return 0===aL&&(aL=10*Q),0===aW&&(aW=10*O),aM>aR?(aS=aE,aV=aP*aM,aK=0>aO?aw-aV:aV+aw,0>aK?(aK=0,aQ=Math.abs((aK-aw)/aM),aS=0>aU?aH-aQ:aQ+aH):aK>Q&&(aK=Q,aQ=Math.abs((aK-aw)/aM),aS=0>aU?aH-aQ:aQ+aH)):(aK=av,aQ=aN/aM,aS=0>aU?aH-aQ:aH+aQ,0>aS?(aS=0,aV=Math.abs((aS-aH)*aM),aK=0>aO?aw-aV:aV+aw):aS>O&&(aS=O,aV=Math.abs(aS-aH)*aM,aK=0>aO?aw-aV:aV+aw)),aK>aw?(aT>aK-aw?aK=aw+aT:aK-aw>aL&&(aK=aw+aL),aS=aS>aH?aH+(aK-aw)/aM:aH-(aK-aw)/aM):aw>aK&&(aT>aw-aK?aK=aw-aT:aw-aK>aL&&(aK=aw-aL),aS=aS>aH?aH+(aw-aK)/aM:aH-(aw-aK)/aM),0>aK?(aw-=aK,aK=0):aK>Q&&(aw-=aK-Q,aK=Q),0>aS?(aH-=aS,aS=0):aS>O&&(aH-=aS-O,aS=O),aF(aD(aw,aH,aK,aS))}function az(aK){return aK[0]<0&&(aK[0]=0),aK[1]<0&&(aK[1]=0),aK[0]>Q&&(aK[0]=Q),aK[1]>O&&(aK[1]=O),[Math.round(aK[0]),Math.round(aK[1])]}function aD(aN,aP,aM,aO){var aR=aN,aQ=aM,aL=aP,aK=aO;return aN>aM&&(aR=aM,aQ=aN),aP>aO&&(aL=aO,aK=aP),[aR,aL,aQ,aK]}function aG(){var aM,aL=av-aw,aK=aE-aH;return y&&Math.abs(aL)>y&&(av=aL>0?aw+y:aw-y),am&&Math.abs(aK)>am&&(aE=aK>0?aH+am:aH-am),T/f&&Math.abs(aK)<T/f&&(aE=aK>0?aH+T/f:aH-T/f),p/M&&Math.abs(aL)<p/M&&(av=aL>0?aw+p/M:aw-p/M),0>aw&&(av-=aw,aw-=aw),0>aH&&(aE-=aH,aH-=aH),0>av&&(aw-=av,av-=av),0>aE&&(aH-=aE,aE-=aE),av>Q&&(aM=av-Q,aw-=aM,av-=aM),aE>O&&(aM=aE-O,aH-=aM,aE-=aM),aw>Q&&(aM=aw-O,aE-=aM,aH-=aM),aH>O&&(aM=aH-O,aE-=aM,aH-=aM),aF(aD(aw,aH,av,aE))}function aF(aK){return{x:aK[0],y:aK[1],x2:aK[2],y2:aK[3],w:aK[2]-aK[0],h:aK[3]-aK[1]}}var ay,ax,aw=0,aH=0,av=0,aE=0;return{flipCoords:aD,setPressed:aB,setCurrent:aA,getOffset:aJ,moveOffset:au,getCorner:aC,getFixed:aI}}(),d=function(){function aG(aH,aI){ay.left.css({height:n(aI)}),ay.right.css({height:n(aI)})}function av(){return aB(aa.getFixed())}function aB(aH){ay.top.css({left:n(aH.x),width:n(aH.w),height:n(aH.y)}),ay.bottom.css({top:n(aH.y2),left:n(aH.x),width:n(aH.w),height:n(O-aH.y2)}),ay.right.css({left:n(aH.x2),width:n(Q-aH.x2)}),ay.left.css({width:n(aH.x)})}function aA(){return a("<div />").css({position:"absolute",backgroundColor:I.shadeColor||I.bgColor}).appendTo(aE)}function ax(){az||(az=!0,aE.insertBefore(ar),av(),V.setBgOpacity(1,0,1),J.hide(),aD(I.shadeColor||I.bgColor,1),V.isAwake()?aw(I.bgOpacity,1):aw(1,1))}function aD(aH,aI){h(au(),aH,aI)}function aF(){az&&(aE.remove(),J.show(),az=!1,V.isAwake()?V.setBgOpacity(I.bgOpacity,1,1):(V.setBgOpacity(1,1,1),V.disableHandles()),h(Z,0,1))}function aw(aI,aH){az&&(I.bgFade&&!aH?aE.animate({opacity:1-aI},{queue:!1,duration:I.fadeTime}):aE.css({opacity:1-aI}))}function aC(){I.shade?ax():aF(),V.isAwake()&&aw(I.bgOpacity)}function au(){return aE.children()}var az=!1,aE=a("<div />").css({position:"absolute",zIndex:240,opacity:0}),ay={top:aA(),left:aA().height(O),right:aA().height(O),bottom:aA()};return{update:av,updateRaw:aB,getShades:au,setBgColor:aD,enable:ax,disable:aF,resize:aG,refresh:aC,opacity:aw}}(),V=function(){function aC(aV){var aW=a("<div />").css({position:"absolute",opacity:I.borderOpacity}).addClass(D(aV));return l.append(aW),aW}function ax(aV,aW){var aX=a("<div />").mousedown(c(aV)).css({cursor:aV+"-resize",position:"absolute",zIndex:aW}).addClass("ord-"+aV);return S.support&&aX.bind("touchstart.jcrop",S.createDragger(aV)),K.append(aX),aX}function aG(aV){var aW=I.handleSize,aX=ax(aV,aO++).css({opacity:I.handleOpacity}).addClass(D("handle"));return aW&&aX.width(aW).height(aW),aX}function aM(aV){return ax(aV,aO++).addClass("jcrop-dragbar")}function aJ(aV){var aW;for(aW=0;aW<aV.length;aW++){aw[aV[aW]]=aM(aV[aW])}}function aN(aV){var aW,aX;for(aX=0;aX<aV.length;aX++){switch(aV[aX]){case"n":aW="hline";break;case"s":aW="hline bottom";break;case"e":aW="vline right";break;case"w":aW="vline"}aB[aV[aX]]=aC(aW)}}function aI(aV){var aW;for(aW=0;aW<aV.length;aW++){aR[aV[aW]]=aG(aV[aW])}}function aE(aV,aW){I.shade||J.css({top:n(-aW),left:n(-aV)}),z.css({top:n(aW),left:n(aV)})}function aU(aV,aW){z.width(Math.round(aV)).height(Math.round(aW))}function az(){var aV=aa.getFixed();aa.setPressed([aV.x,aV.y]),aa.setCurrent([aV.x2,aV.y2]),aS()}function aS(aV){return aF?aD(aV):void 0}function aD(aV){var aW=aa.getFixed();aU(aW.w,aW.h),aE(aW.x,aW.y),I.shade&&d.updateRaw(aW),aF||aT(),aV?I.onSelect.call(i,Y(aW)):I.onChange.call(i,Y(aW))}function av(aW,aX,aV){(aF||aX)&&(I.bgFade&&!aV?ar.animate({opacity:aW},{queue:!1,duration:I.fadeTime}):ar.css("opacity",aW))}function aT(){z.show(),I.shade?d.opacity(ab):av(ab,!0),aF=!0}function aP(){aQ(),z.hide(),I.shade?d.opacity(1):av(1),aF=!1,I.onRelease.call(i)}function au(){ay&&K.show()}function aK(){return ay=!0,I.allowResize?(K.show(),!0):void 0}function aQ(){ay=!1,K.hide()}function aL(aV){aV?(C=!0,aQ()):(C=!1,aK())}function aH(){aL(!1),az()}var aF,aO=370,aB={},aR={},aw={},ay=!1;I.dragEdges&&a.isArray(I.createDragbars)&&aJ(I.createDragbars),a.isArray(I.createHandles)&&aI(I.createHandles),I.drawBorders&&a.isArray(I.createBorders)&&aN(I.createBorders),a(document).bind("touchstart.jcrop-ios",function(aV){a(aV.currentTarget).hasClass("jcrop-tracker")&&aV.stopPropagation()});var aA=ag().mousedown(c("move")).css({cursor:"move",position:"absolute",zIndex:360});return S.support&&aA.bind("touchstart.jcrop",S.createDragger("move")),l.append(aA),aQ(),{updateVisible:aS,update:aD,release:aP,refresh:az,isAwake:function(){return aF},setCursor:function(aV){aA.css("cursor",aV)},enableHandles:aK,enableOnly:function(){ay=!0},showHandles:au,disableHandles:aQ,animMode:aL,setBgOpacity:av,done:aH}}(),P=function(){function aE(aF){b.css({zIndex:450}),aF?a(document).bind("touchmove.jcrop",aD).bind("touchend.jcrop",aA):av&&a(document).bind("mousemove.jcrop",au).bind("mouseup.jcrop",ay)}function aC(){b.css({zIndex:290}),a(document).unbind(".jcrop")}function au(aF){return aw(G(aF)),!1}function ay(aF){return aF.preventDefault(),aF.stopPropagation(),r&&(r=!1,ax(G(aF)),V.isAwake()&&I.onSelect.call(i,Y(aa.getFixed())),aC(),aw=function(){},ax=function(){}),!1}function az(aG,aF,aH){return r=!0,aw=aG,ax=aF,aE(aH),!1}function aD(aF){return aw(G(S.cfilter(aF))),!1}function aA(aF){return ay(S.cfilter(aF))}function aB(aF){b.css("cursor",aF)}var aw=function(){},ax=function(){},av=I.trackDocument;return av||b.mousemove(au).mouseup(ay).mouseout(ay),ar.before(b),{activateHandlers:az,setCursor:aB}}(),aq=function(){function av(){I.keySupport&&(aw.show(),aw.focus())}function az(){aw.hide()}function ax(aB,aA,aC){I.allowMove&&(aa.moveOffset([aA,aC]),V.updateVisible(!0)),aB.preventDefault(),aB.stopPropagation()}function au(aB){if(aB.ctrlKey||aB.metaKey){return !0}ad=aB.shiftKey?!0:!1;var aA=ad?10:1;switch(aB.keyCode){case 37:ax(aB,-aA,0);break;case 39:ax(aB,aA,0);break;case 38:ax(aB,0,-aA);break;case 40:ax(aB,0,aA);break;case 27:I.allowSelect&&V.release();break;case 9:return !0}return !1}var aw=a('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),ay=a("<div />").css({position:"absolute",overflow:"hidden"}).append(aw);return I.keySupport&&(aw.keydown(au).blur(az),ah||!I.fixedSupport?(aw.css({position:"absolute",left:"-20px"}),ay.append(aw).insertBefore(ar)):aw.insertBefore(ar)),{watchKeys:av}}();S.support&&b.bind("touchstart.jcrop",S.newSelection),K.hide(),N(!0);var i={setImage:at,animateTo:v,setSelect:L,setOptions:w,tellSelect:k,tellScaled:al,setClass:m,disable:x,enable:X,cancel:o,release:V.release,destroy:aj,focus:aq.watchKeys,getBounds:function(){return[Q*M,O*f]},getWidgetSize:function(){return[Q,O]},getScaleFactor:function(){return[M,f]},getOptions:function(){return I},ui:{holder:Z,selection:z}};return ac&&Z.bind("selectstart",function(){return !1}),W.data("Jcrop",i),i},a.fn.Jcrop=function(b,d){var c;return this.each(function(){if(a(this).data("Jcrop")){if("api"===b){return a(this).data("Jcrop")}a(this).data("Jcrop").setOptions(b)}else{"IMG"==this.tagName?a.Jcrop.Loader(this,function(){a(this).css({display:"block",visibility:"hidden"}),c=a.Jcrop(this,b),a.isFunction(d)&&d.call(c)}):(a(this).css({display:"block",visibility:"hidden"}),c=a.Jcrop(this,b),a.isFunction(d)&&d.call(c))}}),this},a.Jcrop.Loader=function(f,g,c){function e(){b.complete?(d.unbind(".jcloader"),a.isFunction(g)&&g.call(b)):window.setTimeout(e,50)}var d=a(f),b=d[0];d.bind("load.jcloader",e).bind("error.jcloader",function(){d.unbind(".jcloader"),a.isFunction(c)&&c.call(b)}),b.complete&&a.isFunction(g)&&(d.unbind(".jcloader"),g.call(b))},a.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:0.6,bgFade:!1,borderOpacity:0.4,handleOpacity:0.5,handleSize:null,aspectRatio:0,keySupport:!0,createHandles:["n","s","e","w","nw","ne","se","sw"],createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}}(jQuery);
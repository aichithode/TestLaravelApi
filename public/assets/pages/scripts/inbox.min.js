var AppInbox=function(){var j=$(".inbox-content");var f=$(".inbox-loading");var c="";var g=function(p,o){var n="app_inbox_inbox.html";var q=$(".inbox-nav > li."+o+" a").attr("data-title");c=o;f.show();j.html("");h(p);$.ajax({type:"GET",cache:false,url:n,dataType:"html",success:function(r){h(p);$(".inbox-nav > li.active").removeClass("active");$(".inbox-nav > li."+o).addClass("active");$(".inbox-header > h1").text(q);f.hide();j.html(r);if(Layout.fixContentHeight){Layout.fixContentHeight()}App.initUniform()},error:function(t,r,s){h(p)},async:false});jQuery("body").on("change",".mail-group-checkbox",function(){var s=jQuery(".mail-checkbox");var r=jQuery(this).is(":checked");jQuery(s).each(function(){$(this).attr("checked",r)});jQuery.uniform.update(s)})};var a=function(p,o,q){var n="app_inbox_view.html";f.show();j.html("");h(p);var r=p.parent("tr").attr("data-messageid");$.ajax({type:"GET",cache:false,url:n,dataType:"html",data:{message_id:r},success:function(s){h(p);if(q){$(".inbox-nav > li.active").removeClass("active")}$(".inbox-header > h1").text("View Message");f.hide();j.html(s);Layout.fixContentHeight();App.initUniform()},error:function(u,s,t){h(p)},async:false})};var m=function(){$(".inbox-wysihtml5").wysihtml5({stylesheets:["../assets/global/plugins/bootstrap-wysihtml5/wysiwyg-color.css"]})};var i=function(){$("#fileupload").fileupload({url:"../assets/global/plugins/jquery-file-upload/server/php/",autoUpload:true});if($.support.cors){$.ajax({url:"../assets/global/plugins/jquery-file-upload/server/php/",type:"HEAD"}).fail(function(){$('<span class="alert alert-error"/>').text("Upload server currently unavailable - "+new Date()).appendTo("#fileupload")})}};var l=function(o){var n="app_inbox_compose.html";f.show();j.html("");h(o);$.ajax({type:"GET",cache:false,url:n,dataType:"html",success:function(p){h(o);$(".inbox-nav > li.active").removeClass("active");$(".inbox-header > h1").text("Compose");f.hide();j.html(p);i();m();$(".inbox-wysihtml5").focus();Layout.fixContentHeight();App.initUniform()},error:function(r,p,q){h(o)},async:false})};var b=function(p){var n=$(p).attr("data-messageid");var o="app_inbox_reply.html&messageid="+n;f.show();j.html("");h(p);$.ajax({type:"GET",cache:false,url:o,dataType:"html",success:function(q){h(p);$(".inbox-nav > li.active").removeClass("active");$(".inbox-header > h1").text("Reply");f.hide();j.html(q);$('[name="message"]').val($("#reply_email_content_body").html());e();i();m();Layout.fixContentHeight();App.initUniform()},error:function(s,q,r){h(p)},async:false})};var d=function(o){var n="app_inbox_inbox.html";f.show();j.html("");h(o);$.ajax({type:"GET",cache:false,url:n,dataType:"html",success:function(p){h(o);$(".inbox-nav > li.active").removeClass("active");$(".inbox-header > h1").text("Search");f.hide();j.html(p);Layout.fixContentHeight();App.initUniform()},error:function(r,p,q){h(o)},async:false})};var e=function(){var o=$(".inbox-compose .mail-to .inbox-cc");var n=$(".inbox-compose .input-cc");o.hide();n.show();$(".close",n).click(function(){n.hide();o.show()})};var k=function(){var o=$(".inbox-compose .mail-to .inbox-bcc");var n=$(".inbox-compose .input-bcc");o.hide();n.show();$(".close",n).click(function(){n.hide();o.show()})};var h=function(n){if(typeof n=="undefined"){return}if(n.attr("disabled")){n.attr("disabled",false)}else{n.attr("disabled",true)}};return{init:function(){$(".inbox").on("click",".compose-btn a",function(){l($(this))});$(".inbox").on("click",".inbox-discard-btn",function(n){n.preventDefault();g($(this),c)});$(".inbox").on("click",".reply-btn",function(){b($(this))});$(".inbox-content").on("click",".view-message",function(){a($(this))});$(".inbox-nav > li.inbox > a").click(function(){g($(this),"inbox")});$(".inbox-nav > li.sent > a").click(function(){g($(this),"sent")});$(".inbox-nav > li.draft > a").click(function(){g($(this),"draft")});$(".inbox-nav > li.trash > a").click(function(){g($(this),"trash")});$(".inbox-content").on("click",".mail-to .inbox-cc",function(){e()});$(".inbox-content").on("click",".mail-to .inbox-bcc",function(){k()});if(App.getURLParameter("a")==="view"){a()}else{if(App.getURLParameter("a")==="compose"){l()}else{$(".inbox-nav > li.inbox > a").click()}}}}}();jQuery(document).ready(function(){AppInbox.init()});
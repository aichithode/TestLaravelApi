var AppInbox=function(){var q=$(".inbox-content");var u=$(".inbox-loading");var x="";var t=function(b,c){var d="app_inbox_inbox.html";var a=$(".inbox-nav > li."+c+" a").attr("data-title");x=c;u.show();q.html("");s(b);$.ajax({type:"GET",cache:false,url:d,dataType:"html",success:function(e){s(b);$(".inbox-nav > li.active").removeClass("active");$(".inbox-nav > li."+c).addClass("active");$(".inbox-header > h1").text(a);u.hide();q.html(e);if(Layout.fixContentHeight){Layout.fixContentHeight()}App.initUniform()},error:function(e,g,f){s(b)},async:false});jQuery("body").on("change",".mail-group-checkbox",function(){var e=jQuery(".mail-checkbox");var f=jQuery(this).is(":checked");jQuery(e).each(function(){$(this).attr("checked",f)});jQuery.uniform.update(e)})};var z=function(c,d,b){var e="app_inbox_view.html";u.show();q.html("");s(c);var a=c.parent("tr").attr("data-messageid");$.ajax({type:"GET",cache:false,url:e,dataType:"html",data:{message_id:a},success:function(f){s(c);if(b){$(".inbox-nav > li.active").removeClass("active")}$(".inbox-header > h1").text("View Message");u.hide();q.html(f);Layout.fixContentHeight();App.initUniform()},error:function(f,h,g){s(c)},async:false})};var n=function(){$(".inbox-wysihtml5").wysihtml5({stylesheets:["../assets/global/plugins/bootstrap-wysihtml5/wysiwyg-color.css"]})};var r=function(){$("#fileupload").fileupload({url:"../assets/global/plugins/jquery-file-upload/server/php/",autoUpload:true});if($.support.cors){$.ajax({url:"../assets/global/plugins/jquery-file-upload/server/php/",type:"HEAD"}).fail(function(){$('<span class="alert alert-error"/>').text("Upload server currently unavailable - "+new Date()).appendTo("#fileupload")})}};var o=function(a){var b="app_inbox_compose.html";u.show();q.html("");s(a);$.ajax({type:"GET",cache:false,url:b,dataType:"html",success:function(c){s(a);$(".inbox-nav > li.active").removeClass("active");$(".inbox-header > h1").text("Compose");u.hide();q.html(c);r();n();$(".inbox-wysihtml5").focus();Layout.fixContentHeight();App.initUniform()},error:function(c,e,d){s(a)},async:false})};var y=function(a){var c=$(a).attr("data-messageid");var b="app_inbox_reply.html&messageid="+c;u.show();q.html("");s(a);$.ajax({type:"GET",cache:false,url:b,dataType:"html",success:function(d){s(a);$(".inbox-nav > li.active").removeClass("active");$(".inbox-header > h1").text("Reply");u.hide();q.html(d);$('[name="message"]').val($("#reply_email_content_body").html());v();r();n();Layout.fixContentHeight();App.initUniform()},error:function(d,f,e){s(a)},async:false})};var w=function(a){var b="app_inbox_inbox.html";u.show();q.html("");s(a);$.ajax({type:"GET",cache:false,url:b,dataType:"html",success:function(c){s(a);$(".inbox-nav > li.active").removeClass("active");$(".inbox-header > h1").text("Search");u.hide();q.html(c);Layout.fixContentHeight();App.initUniform()},error:function(c,e,d){s(a)},async:false})};var v=function(){var a=$(".inbox-compose .mail-to .inbox-cc");var b=$(".inbox-compose .input-cc");a.hide();b.show();$(".close",b).click(function(){b.hide();a.show()})};var p=function(){var a=$(".inbox-compose .mail-to .inbox-bcc");var b=$(".inbox-compose .input-bcc");a.hide();b.show();$(".close",b).click(function(){b.hide();a.show()})};var s=function(a){if(typeof a=="undefined"){return}if(a.attr("disabled")){a.attr("disabled",false)}else{a.attr("disabled",true)}};return{init:function(){$(".inbox").on("click",".compose-btn a",function(){o($(this))});$(".inbox").on("click",".inbox-discard-btn",function(a){a.preventDefault();t($(this),x)});$(".inbox").on("click",".reply-btn",function(){y($(this))});$(".inbox-content").on("click",".view-message",function(){z($(this))});$(".inbox-nav > li.inbox > a").click(function(){t($(this),"inbox")});$(".inbox-nav > li.sent > a").click(function(){t($(this),"sent")});$(".inbox-nav > li.draft > a").click(function(){t($(this),"draft")});$(".inbox-nav > li.trash > a").click(function(){t($(this),"trash")});$(".inbox-content").on("click",".mail-to .inbox-cc",function(){v()});$(".inbox-content").on("click",".mail-to .inbox-bcc",function(){p()});if(App.getURLParameter("a")==="view"){z()}else{if(App.getURLParameter("a")==="compose"){o()}else{$(".inbox-nav > li.inbox > a").click()}}}}}();jQuery(document).ready(function(){AppInbox.init()});